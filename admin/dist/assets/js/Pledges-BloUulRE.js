import{r as a,_ as e,x as l,A as t,o as s,D as d,B as u,J as r,M as i,C as o,ay as n,Y as c,aI as p,m as _,u as v,O as m,F as f,K as g}from"./vue-vendor-CCmsYA1Y.js";import{g as w,X as b,f as h,Y as y,S as x,I as S,T as z,b as C,N as k}from"./element-plus-BZcENYie.js";import{bC as U}from"./vendor-BQF3adi-.js";import{r as V}from"./index-CQDoFXMh.js";import{_ as D}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./index-Gc17XYwO.js";const Y={class:"page-container"},j={class:"page-header"},P={class:"stat-card"},T={class:"stat-icon primary"},M={class:"stat-info"},F={class:"stat-value"},I={class:"stat-card"},O={class:"stat-icon success"},$={class:"stat-info"},H={class:"stat-value"},A={class:"stat-card"},B={class:"stat-icon warning"},J={class:"stat-info"},K={class:"stat-value"},N={class:"stat-card"},X={class:"stat-icon info"},q={class:"stat-info"},E={class:"stat-value"},G={class:"search-area"},L=["onClick"],Q={class:"amount positive"},R={class:"rate"},W={class:"amount"},Z={class:"pagination-wrapper"},aa={class:"amount positive"},ea=D({__name:"Pledges",setup(D){const ea=a(!1),la=e({totalPledge:0,activePledges:0,expiringSoon:0,completedPledges:0}),ta=a([]),sa=e({wallet_address:"",status:"",product:""}),da=e({page:1,pageSize:10,total:0}),ua=a(!1),ra=a(null),ia=async()=>{ea.value=!0;try{const a=await V.get("/pledges",{params:{page:da.page,pageSize:da.pageSize,wallet_address:sa.wallet_address||void 0,status:sa.status||void 0,product:sa.product||void 0}});a.success&&(ta.value=a.data.list||[],da.total=a.data.total||0,a.data.stats&&Object.assign(la,a.data.stats))}catch(a){ta.value=[],da.total=0}finally{ea.value=!1}},oa=()=>{da.page=1,ia()},na=()=>{sa.wallet_address="",sa.status="",sa.product="",da.page=1,ia()},ca=()=>{da.page=1,ia()},pa=()=>{ia()},_a=a=>{navigator.clipboard.writeText(a),C.success("已复制")},va=a=>parseFloat(a||0).toFixed(2),ma=a=>U(a).format("YYYY-MM-DD"),fa=a=>U(a).format("YYYY-MM-DD HH:mm:ss"),ga=a=>({active:"进行中",completed:"已完成",cancelled:"已取消"}[a]||a);return l(()=>{(async()=>{try{const a=await V.get("/pledges/stats");a.success&&a.data&&Object.assign(la,a.data)}catch(a){}})(),ia()}),(a,e)=>{const l=n("el-icon"),U=n("el-col"),D=n("el-row"),wa=n("el-input"),ba=n("el-form-item"),ha=n("el-option"),ya=n("el-select"),xa=n("el-button"),Sa=n("el-form"),za=n("el-table-column"),Ca=n("el-tag"),ka=n("el-table"),Ua=n("el-pagination"),Va=n("el-descriptions-item"),Da=n("el-descriptions"),Ya=n("el-drawer"),ja=p("loading");return s(),t("div",Y,[d("div",j,[d("h2",null,[u(l,null,{default:o(()=>[u(v(w))]),_:1}),e[7]||(e[7]=i(" 质押管理 ",-1))]),e[8]||(e[8]=d("p",{class:"description"},"查看和管理用户的质押记录",-1))]),u(D,{gutter:20,class:"stats-row"},{default:o(()=>[u(U,{xs:24,sm:12,md:6},{default:o(()=>[d("div",P,[d("div",T,[u(l,null,{default:o(()=>[u(v(w))]),_:1})]),d("div",M,[d("div",F,m(va(la.totalPledge)),1),e[9]||(e[9]=d("div",{class:"stat-label"},"质押总额 (USDT)",-1))])])]),_:1}),u(U,{xs:24,sm:12,md:6},{default:o(()=>[d("div",I,[d("div",O,[u(l,null,{default:o(()=>[u(v(b))]),_:1})]),d("div",$,[d("div",H,m(la.activePledges),1),e[10]||(e[10]=d("div",{class:"stat-label"},"进行中",-1))])])]),_:1}),u(U,{xs:24,sm:12,md:6},{default:o(()=>[d("div",A,[d("div",B,[u(l,null,{default:o(()=>[u(v(h))]),_:1})]),d("div",J,[d("div",K,m(la.expiringSoon),1),e[11]||(e[11]=d("div",{class:"stat-label"},"即将到期",-1))])])]),_:1}),u(U,{xs:24,sm:12,md:6},{default:o(()=>[d("div",N,[d("div",X,[u(l,null,{default:o(()=>[u(v(y))]),_:1})]),d("div",q,[d("div",E,m(la.completedPledges),1),e[12]||(e[12]=d("div",{class:"stat-label"},"已完成",-1))])])]),_:1})]),_:1}),d("div",G,[u(Sa,{inline:!0,model:sa,onSubmit:c(oa,["prevent"])},{default:o(()=>[u(ba,{label:"钱包地址"},{default:o(()=>[u(wa,{modelValue:sa.wallet_address,"onUpdate:modelValue":e[0]||(e[0]=a=>sa.wallet_address=a),placeholder:"请输入钱包地址",clearable:"",style:{width:"280px"}},null,8,["modelValue"])]),_:1}),u(ba,{label:"质押状态"},{default:o(()=>[u(ya,{modelValue:sa.status,"onUpdate:modelValue":e[1]||(e[1]=a=>sa.status=a),placeholder:"全部",clearable:"",style:{width:"140px"}},{default:o(()=>[u(ha,{label:"进行中",value:"active"}),u(ha,{label:"已完成",value:"completed"}),u(ha,{label:"已取消",value:"cancelled"})]),_:1},8,["modelValue"])]),_:1}),u(ba,{label:"质押产品"},{default:o(()=>[u(ya,{modelValue:sa.product,"onUpdate:modelValue":e[2]||(e[2]=a=>sa.product=a),placeholder:"全部",clearable:"",style:{width:"140px"}},{default:o(()=>[u(ha,{label:"30天锁仓",value:"30days"}),u(ha,{label:"60天锁仓",value:"60days"}),u(ha,{label:"90天锁仓",value:"90days"}),u(ha,{label:"180天锁仓",value:"180days"})]),_:1},8,["modelValue"])]),_:1}),u(ba,null,{default:o(()=>[u(xa,{type:"primary",onClick:oa},{default:o(()=>[u(l,null,{default:o(()=>[u(v(x))]),_:1}),e[13]||(e[13]=i(" 搜索 ",-1))]),_:1}),u(xa,{onClick:na},{default:o(()=>[u(l,null,{default:o(()=>[u(v(S))]),_:1}),e[14]||(e[14]=i(" 重置 ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),r((s(),_(ka,{data:ta.value,stripe:"",border:"",style:{width:"100%"}},{default:o(()=>[u(za,{type:"index",label:"序号",width:"60",align:"center"}),u(za,{prop:"wallet_address",label:"钱包地址","min-width":"180"},{default:o(({row:a})=>{return[d("div",{class:"wallet-address",onClick:e=>_a(a.wallet_address)},[i(m((e=a.wallet_address,e?e.length<=20?e:`${e.slice(0,10)}...${e.slice(-8)}`:""))+" ",1),u(l,null,{default:o(()=>[u(v(z))]),_:1})],8,L)];var e}),_:1}),u(za,{prop:"product_name",label:"质押产品",width:"120"},{default:o(({row:a})=>[u(Ca,{type:"primary",size:"small"},{default:o(()=>[i(m(a.product_name),1)]),_:2},1024)]),_:1}),u(za,{prop:"amount",label:"质押金额",width:"140",align:"right"},{default:o(({row:a})=>[d("span",Q,m(va(a.amount))+" USDT",1)]),_:1}),u(za,{prop:"apr",label:"年化收益率",width:"110",align:"center"},{default:o(({row:a})=>[d("span",R,m(a.apr)+"%",1)]),_:1}),u(za,{prop:"expected_reward",label:"预期收益",width:"130",align:"right"},{default:o(({row:a})=>[d("span",W,m(va(a.expected_reward))+" USDT",1)]),_:1}),u(za,{prop:"status",label:"状态",width:"100",align:"center"},{default:o(({row:a})=>[d("span",{class:f(["status-badge",a.status])},m(ga(a.status)),3)]),_:1}),u(za,{prop:"start_date",label:"开始日期",width:"120"},{default:o(({row:a})=>[i(m(ma(a.start_date)),1)]),_:1}),u(za,{prop:"end_date",label:"到期日期",width:"120"},{default:o(({row:a})=>[i(m(ma(a.end_date)),1)]),_:1}),u(za,{label:"操作",width:"150",fixed:"right",align:"center"},{default:o(({row:a})=>[u(xa,{type:"primary",link:"",size:"small",onClick:e=>(a=>{ra.value=a,ua.value=!0})(a)},{default:o(()=>[...e[15]||(e[15]=[i(" 详情 ",-1)])]),_:1},8,["onClick"]),"active"===a.status?(s(),_(xa,{key:0,type:"danger",link:"",size:"small",onClick:e=>(async a=>{try{await k.confirm("确定取消此质押吗？取消后本金将退回用户账户，已产生的收益将清零。","确认取消",{type:"warning"});const e=await V.post(`/pledges/${a.id}/cancel`);e.success?(C.success("取消成功"),ia()):C.error(e.message||"取消失败")}catch{}})(a)},{default:o(()=>[...e[16]||(e[16]=[i(" 取消 ",-1)])]),_:1},8,["onClick"])):g("",!0)]),_:1})]),_:1},8,["data"])),[[ja,ea.value]]),d("div",Z,[u(Ua,{"current-page":da.page,"onUpdate:currentPage":e[3]||(e[3]=a=>da.page=a),"page-size":da.pageSize,"onUpdate:pageSize":e[4]||(e[4]=a=>da.pageSize=a),"page-sizes":[10,20,50,100],total:da.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:ca,onCurrentChange:pa},null,8,["current-page","page-size","total"])]),u(Ya,{modelValue:ua.value,"onUpdate:modelValue":e[6]||(e[6]=a=>ua.value=a),title:"质押详情",size:"500px"},{default:o(()=>[ra.value?(s(),_(Da,{key:0,column:1,border:""},{default:o(()=>[u(Va,{label:"钱包地址"},{default:o(()=>[d("span",{class:"wallet-address",onClick:e[5]||(e[5]=a=>_a(ra.value.wallet_address))},[i(m(ra.value.wallet_address)+" ",1),u(l,null,{default:o(()=>[u(v(z))]),_:1})])]),_:1}),u(Va,{label:"质押产品"},{default:o(()=>[i(m(ra.value.product_name),1)]),_:1}),u(Va,{label:"质押金额"},{default:o(()=>[d("span",aa,m(va(ra.value.amount))+" USDT",1)]),_:1}),u(Va,{label:"年化收益率"},{default:o(()=>[i(m(ra.value.apr)+"% ",1)]),_:1}),u(Va,{label:"预期收益"},{default:o(()=>[i(m(va(ra.value.expected_reward))+" USDT ",1)]),_:1}),u(Va,{label:"已发放收益"},{default:o(()=>[i(m(va(ra.value.paid_reward))+" USDT ",1)]),_:1}),u(Va,{label:"状态"},{default:o(()=>[d("span",{class:f(["status-badge",ra.value.status])},m(ga(ra.value.status)),3)]),_:1}),u(Va,{label:"开始时间"},{default:o(()=>[i(m(fa(ra.value.start_date)),1)]),_:1}),u(Va,{label:"到期时间"},{default:o(()=>[i(m(fa(ra.value.end_date)),1)]),_:1}),u(Va,{label:"创建时间"},{default:o(()=>[i(m(fa(ra.value.created_at)),1)]),_:1})]),_:1})):g("",!0)]),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-796d6d73"]]);export{ea as default};
