import{r as e,_ as a,x as l,V as t,A as r,o as s,D as o,B as d,C as n,ay as i,aI as c,M as u,u as p,O as v,ap as _,J as f,m as g,K as b,Y as m}from"./vue-vendor-CCmsYA1Y.js";import{b as y,E as h,I as w,S as C,N as k}from"./element-plus-BZcENYie.js";import{r as x}from"./index-CQDoFXMh.js";import{_ as z}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./vendor-BQF3adi-.js";import"./index-Gc17XYwO.js";const V={class:"error-logs-page"},S={class:"page-header"},I={class:"stats-cards"},T={class:"stat-info"},j={class:"stat-value"},O={class:"stat-info"},U={class:"stat-value"},q={class:"stat-info"},A={class:"stat-value"},E={class:"stat-info"},J={class:"stat-value"},N={class:"error-message"},P={class:"pagination"},$={key:0,class:"error-detail"},B={class:"detail-section"},D={class:"code-block"},G={key:0,class:"detail-section"},R={class:"code-block"},K={key:1,class:"detail-section"},L={class:"code-block"},W={key:2,class:"detail-section"},M={class:"code-block"},Y={key:3,class:"detail-section"},F={class:"dialog-footer"},H=z({__name:"ErrorLogs",setup(z){const H=e(!1),Q=e([]),X=e([]),Z=e(0);let ee=null;const ae=a({errorCount:0,criticalCount:0,unresolvedCount:0,frontendCount:0}),le=a({level:"",source:"",resolved:null,start_date:"",end_date:"",search:""}),te=a({page:1,pageSize:20,total:0}),re=a({visible:!1,data:null}),se=async()=>{H.value=!0;try{const e={page:te.page,pageSize:te.pageSize,...le,resolved:null===le.resolved?void 0:le.resolved},a=await x.get("/error-logs",{params:e});a.success&&(Q.value=a.data.list,te.total=a.data.total)}catch(e){y.error("èŽ·å–é”™è¯¯æ—¥å¿—å¤±è´¥")}finally{H.value=!1}},oe=e=>{e&&2===e.length?(le.start_date=e[0].toISOString().split("T")[0],le.end_date=e[1].toISOString().split("T")[0]):(le.start_date="",le.end_date=""),se()},de=async e=>{try{const a=await x.get(`/error-logs/${e.id}`);a.success&&(re.data=a.data,re.visible=!0)}catch(a){y.error("èŽ·å–é”™è¯¯è¯¦æƒ…å¤±è´¥")}},ne=async e=>{try{const{value:a}=await k.prompt("è¯·è¾“å…¥è§£å†³å¤‡æ³¨ï¼ˆå¯é€‰ï¼‰","æ ‡è®°ä¸ºå·²è§£å†³",{confirmButtonText:"ç¡®å®š",cancelButtonText:"å–æ¶ˆ",inputType:"textarea"});(await x.put(`/error-logs/${e.id}/resolve`,{resolution_note:a})).success&&(y.success("å·²æ ‡è®°ä¸ºå·²è§£å†³"),re.visible=!1,ie())}catch(a){"cancel"!==a&&y.error("æ“ä½œå¤±è´¥")}},ie=()=>{se(),(async()=>{var e,a,l;try{const t=await x.get("/error-logs-stats",{params:{timeRange:"24h"}});if(t.success){const r=t.data.levels||[],s=t.data.sources||[];ae.errorCount=r.reduce((e,a)=>e+parseInt(a.count),0),ae.criticalCount=(null==(e=r.find(e=>"critical"===e.error_level))?void 0:e.count)||0,ae.frontendCount=(null==(a=s.find(e=>"frontend"===e.error_source))?void 0:a.count)||0;const o=await x.get("/error-logs",{params:{resolved:!1,pageSize:1}});ae.unresolvedCount=(null==(l=o.data)?void 0:l.total)||0}}catch(t){}})()},ce=e=>({info:"info",warning:"warning",error:"danger",critical:"danger"}[e]||"info"),ue=e=>({info:"Info",warning:"Warning",error:"Error",critical:"Critical"}[e]||e),pe=e=>({frontend:"primary",backend:"success",database:"warning",external_api:"info",cron_job:"danger"}[e]||"info"),ve=e=>({frontend:"å‰ç«¯",backend:"åŽç«¯",database:"æ•°æ®åº“",external_api:"å¤–éƒ¨API",cron_job:"å®šæ—¶ä»»åŠ¡"}[e]||e),_e=e=>{try{return"string"==typeof e?JSON.stringify(JSON.parse(e),null,2):JSON.stringify(e,null,2)}catch{return e}},fe=async()=>{try{const e=await x.get("/error-logs",{params:{page:1,pageSize:1,resolved:!1}});if(e.success&&e.data.list.length>0){const a=e.data.list[0];if(a.id>Z.value){Z.value=a.id,(()=>{try{const e=new(window.AudioContext||window.webkitAudioContext),a=e.createOscillator(),l=e.createGain();a.connect(l),l.connect(e.destination),a.frequency.value=800,l.gain.value=.3,a.start(e.currentTime),a.stop(e.currentTime+.1),setTimeout(()=>{const a=e.createOscillator(),l=e.createGain();a.connect(l),l.connect(e.destination),a.frequency.value=800,l.gain.value=.3,a.start(e.currentTime),a.stop(e.currentTime+.1)},150),setTimeout(()=>{const a=e.createOscillator(),l=e.createGain();a.connect(l),l.connect(e.destination),a.frequency.value=1e3,l.gain.value=.3,a.start(e.currentTime),a.stop(e.currentTime+.15)},300)}catch(e){}})();const e="critical"===a.error_level?"ðŸ”¥ ä¸¥é‡é”™è¯¯":"âŒ æ–°é”™è¯¯";h({title:e,message:`${a.error_type}: ${a.error_message.substring(0,50)}...`,type:"critical"===a.error_level?"error":"warning",duration:8e3,onClick:()=>{de(a)}}),ie()}}}catch(e){}};return l(()=>{ie(),(async()=>{try{const e=await x.get("/error-logs",{params:{page:1,pageSize:1,resolved:!1}});e.success&&e.data.list.length>0&&(Z.value=e.data.list[0].id)}catch(e){}})().then(()=>{setTimeout(()=>{fe()},3e3),ee=setInterval(()=>{fe()},15e3)})}),t(()=>{ee&&(clearInterval(ee),ee=null)}),(e,a)=>{const l=i("el-icon"),t=i("el-button"),y=i("el-card"),h=i("el-option"),k=i("el-select"),x=i("el-form-item"),z=i("el-date-picker"),Z=i("el-input"),ee=i("el-form"),fe=i("el-table-column"),ge=i("el-tag"),be=i("el-badge"),me=i("el-table"),ye=i("el-pagination"),he=i("el-descriptions-item"),we=i("el-descriptions"),Ce=i("el-dialog"),ke=c("loading");return s(),r("div",V,[o("div",S,[a[11]||(a[11]=o("h1",null,"é”™è¯¯æ—¥å¿—ç›‘æŽ§",-1)),d(t,{type:"primary",onClick:ie,loading:H.value},{default:n(()=>[d(l,null,{default:n(()=>[d(p(w))]),_:1}),a[10]||(a[10]=u(" åˆ·æ–° ",-1))]),_:1},8,["loading"])]),o("div",I,[d(y,{class:"stat-card error"},{default:n(()=>[a[13]||(a[13]=o("div",{class:"stat-icon"},"âŒ",-1)),o("div",T,[a[12]||(a[12]=o("div",{class:"stat-label"},"é”™è¯¯æ€»æ•°",-1)),o("div",j,v(ae.errorCount),1)])]),_:1}),d(y,{class:"stat-card critical"},{default:n(()=>[a[15]||(a[15]=o("div",{class:"stat-icon"},"ðŸ”¥",-1)),o("div",O,[a[14]||(a[14]=o("div",{class:"stat-label"},"ä¸¥é‡é”™è¯¯",-1)),o("div",U,v(ae.criticalCount),1)])]),_:1}),d(y,{class:"stat-card unresolved"},{default:n(()=>[a[17]||(a[17]=o("div",{class:"stat-icon"},"âš ï¸",-1)),o("div",q,[a[16]||(a[16]=o("div",{class:"stat-label"},"æœªè§£å†³",-1)),o("div",A,v(ae.unresolvedCount),1)])]),_:1}),d(y,{class:"stat-card frontend"},{default:n(()=>[a[19]||(a[19]=o("div",{class:"stat-icon"},"ðŸŒ",-1)),o("div",E,[a[18]||(a[18]=o("div",{class:"stat-label"},"å‰ç«¯é”™è¯¯",-1)),o("div",J,v(ae.frontendCount),1)])]),_:1})]),d(y,{class:"filter-card"},{default:n(()=>[d(ee,{inline:!0,model:le},{default:n(()=>[d(x,{label:"é”™è¯¯çº§åˆ«"},{default:n(()=>[d(k,{modelValue:le.level,"onUpdate:modelValue":a[0]||(a[0]=e=>le.level=e),placeholder:"å…¨éƒ¨",clearable:"",onChange:se,style:{width:"120px"}},{default:n(()=>[d(h,{label:"Info",value:"info"}),d(h,{label:"Warning",value:"warning"}),d(h,{label:"Error",value:"error"}),d(h,{label:"Critical",value:"critical"})]),_:1},8,["modelValue"])]),_:1}),d(x,{label:"é”™è¯¯æ¥æº"},{default:n(()=>[d(k,{modelValue:le.source,"onUpdate:modelValue":a[1]||(a[1]=e=>le.source=e),placeholder:"å…¨éƒ¨",clearable:"",onChange:se,style:{width:"120px"}},{default:n(()=>[d(h,{label:"å‰ç«¯",value:"frontend"}),d(h,{label:"åŽç«¯",value:"backend"}),d(h,{label:"æ•°æ®åº“",value:"database"}),d(h,{label:"å¤–éƒ¨API",value:"external_api"}),d(h,{label:"å®šæ—¶ä»»åŠ¡",value:"cron_job"})]),_:1},8,["modelValue"])]),_:1}),d(x,{label:"çŠ¶æ€"},{default:n(()=>[d(k,{modelValue:le.resolved,"onUpdate:modelValue":a[2]||(a[2]=e=>le.resolved=e),placeholder:"å…¨éƒ¨",clearable:"",onChange:se,style:{width:"120px"}},{default:n(()=>[d(h,{label:"æœªè§£å†³",value:!1}),d(h,{label:"å·²è§£å†³",value:!0})]),_:1},8,["modelValue"])]),_:1}),d(x,{label:"æ—¶é—´èŒƒå›´"},{default:n(()=>[d(z,{modelValue:X.value,"onUpdate:modelValue":a[3]||(a[3]=e=>X.value=e),type:"daterange","range-separator":"è‡³","start-placeholder":"å¼€å§‹æ—¥æœŸ","end-placeholder":"ç»“æŸæ—¥æœŸ",onChange:oe},null,8,["modelValue"])]),_:1}),d(x,{label:"æœç´¢"},{default:n(()=>[d(Z,{modelValue:le.search,"onUpdate:modelValue":a[4]||(a[4]=e=>le.search=e),placeholder:"é”™è¯¯æ¶ˆæ¯æˆ–ç±»åž‹",clearable:"",onKeyup:_(se,["enter"])},{suffix:n(()=>[d(l,{onClick:se,style:{cursor:"pointer"}},{default:n(()=>[d(p(C))]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1}),d(y,{class:"table-card"},{default:n(()=>[f((s(),g(me,{data:Q.value,stripe:"",style:{width:"100%"},onRowClick:de},{default:n(()=>[d(fe,{prop:"id",label:"ID",width:"80"}),d(fe,{label:"çº§åˆ«",width:"100"},{default:n(({row:e})=>[d(ge,{type:ce(e.error_level),size:"small"},{default:n(()=>[u(v(ue(e.error_level)),1)]),_:2},1032,["type"])]),_:1}),d(fe,{label:"æ¥æº",width:"120"},{default:n(({row:e})=>[d(ge,{type:pe(e.error_source),size:"small"},{default:n(()=>[u(v(ve(e.error_source)),1)]),_:2},1032,["type"])]),_:1}),d(fe,{prop:"error_type",label:"ç±»åž‹",width:"150"}),d(fe,{label:"é”™è¯¯æ¶ˆæ¯","min-width":"300"},{default:n(({row:e})=>[o("div",N,v(e.error_message),1)]),_:1}),d(fe,{label:"å‘ç”Ÿæ¬¡æ•°",width:"100"},{default:n(({row:e})=>[d(be,{value:e.occurrence_count,max:99},null,8,["value"])]),_:1}),d(fe,{label:"çŠ¶æ€",width:"100"},{default:n(({row:e})=>[d(ge,{type:e.resolved?"success":"danger",size:"small"},{default:n(()=>[u(v(e.resolved?"å·²è§£å†³":"æœªè§£å†³"),1)]),_:2},1032,["type"])]),_:1}),d(fe,{prop:"created_at",label:"å‘ç”Ÿæ—¶é—´",width:"180"}),d(fe,{label:"æ“ä½œ",width:"120",fixed:"right"},{default:n(({row:e})=>[e.resolved?b("",!0):(s(),g(t,{key:0,type:"success",size:"small",onClick:m(a=>ne(e),["stop"])},{default:n(()=>[...a[20]||(a[20]=[u(" æ ‡è®°å·²è§£å†³ ",-1)])]),_:1},8,["onClick"]))]),_:1})]),_:1},8,["data"])),[[ke,H.value]]),o("div",P,[d(ye,{"current-page":te.page,"onUpdate:currentPage":a[5]||(a[5]=e=>te.page=e),"page-size":te.pageSize,"onUpdate:pageSize":a[6]||(a[6]=e=>te.pageSize=e),"page-sizes":[10,20,50,100],total:te.total,layout:"total, sizes, prev, pager, next, jumper",onCurrentChange:se,onSizeChange:se},null,8,["current-page","page-size","total"])])]),_:1}),d(Ce,{modelValue:re.visible,"onUpdate:modelValue":a[9]||(a[9]=e=>re.visible=e),title:"é”™è¯¯è¯¦æƒ…",width:"80%","close-on-click-modal":!1,center:"","align-center":"","append-to-body":""},{footer:n(()=>[o("span",F,[d(t,{onClick:a[7]||(a[7]=e=>re.visible=!1)},{default:n(()=>[...a[26]||(a[26]=[u("å…³é—­",-1)])]),_:1}),re.data&&!re.data.resolved?(s(),g(t,{key:0,type:"success",onClick:a[8]||(a[8]=e=>ne(re.data))},{default:n(()=>[...a[27]||(a[27]=[u(" æ ‡è®°å·²è§£å†³ ",-1)])]),_:1})):b("",!0)])]),default:n(()=>[re.data?(s(),r("div",$,[d(we,{column:2,border:""},{default:n(()=>[d(he,{label:"é”™è¯¯ID"},{default:n(()=>[u(v(re.data.id),1)]),_:1}),d(he,{label:"é”™è¯¯çº§åˆ«"},{default:n(()=>[d(ge,{type:ce(re.data.error_level)},{default:n(()=>[u(v(ue(re.data.error_level)),1)]),_:1},8,["type"])]),_:1}),d(he,{label:"é”™è¯¯æ¥æº"},{default:n(()=>[d(ge,{type:pe(re.data.error_source)},{default:n(()=>[u(v(ve(re.data.error_source)),1)]),_:1},8,["type"])]),_:1}),d(he,{label:"é”™è¯¯ç±»åž‹"},{default:n(()=>[u(v(re.data.error_type),1)]),_:1}),d(he,{label:"å‘ç”Ÿæ¬¡æ•°"},{default:n(()=>[u(v(re.data.occurrence_count),1)]),_:1}),d(he,{label:"çŠ¶æ€"},{default:n(()=>[d(ge,{type:re.data.resolved?"success":"danger"},{default:n(()=>[u(v(re.data.resolved?"å·²è§£å†³":"æœªè§£å†³"),1)]),_:1},8,["type"])]),_:1}),d(he,{label:"é¦–æ¬¡å‘ç”Ÿ"},{default:n(()=>[u(v(re.data.first_occurrence),1)]),_:1}),d(he,{label:"æœ€åŽå‘ç”Ÿ"},{default:n(()=>[u(v(re.data.last_occurrence),1)]),_:1}),d(he,{label:"IPåœ°å€"},{default:n(()=>[u(v(re.data.ip_address||"-"),1)]),_:1}),d(he,{label:"é’±åŒ…åœ°å€"},{default:n(()=>[u(v(re.data.wallet_address||"-"),1)]),_:1}),d(he,{label:"è¯·æ±‚æ–¹æ³•"},{default:n(()=>[u(v(re.data.request_method||"-"),1)]),_:1}),d(he,{label:"è¯·æ±‚URL",span:2},{default:n(()=>[u(v(re.data.request_url||"-"),1)]),_:1})]),_:1}),o("div",B,[a[21]||(a[21]=o("h3",null,"é”™è¯¯æ¶ˆæ¯",-1)),o("pre",D,v(re.data.error_message),1)]),re.data.error_stack?(s(),r("div",G,[a[22]||(a[22]=o("h3",null,"å †æ ˆè·Ÿè¸ª",-1)),o("pre",R,v(re.data.error_stack),1)])):b("",!0),re.data.request_params?(s(),r("div",K,[a[23]||(a[23]=o("h3",null,"è¯·æ±‚å‚æ•°",-1)),o("pre",L,v(_e(re.data.request_params)),1)])):b("",!0),re.data.additional_data?(s(),r("div",W,[a[24]||(a[24]=o("h3",null,"é™„åŠ æ•°æ®",-1)),o("pre",M,v(_e(re.data.additional_data)),1)])):b("",!0),re.data.resolved?(s(),r("div",Y,[a[25]||(a[25]=o("h3",null,"è§£å†³ä¿¡æ¯",-1)),d(we,{column:1,border:""},{default:n(()=>[d(he,{label:"è§£å†³äºº"},{default:n(()=>[u(v(re.data.resolved_by),1)]),_:1}),d(he,{label:"è§£å†³æ—¶é—´"},{default:n(()=>[u(v(re.data.resolved_at),1)]),_:1}),d(he,{label:"è§£å†³å¤‡æ³¨"},{default:n(()=>[u(v(re.data.resolution_note||"-"),1)]),_:1})]),_:1})])):b("",!0)])):b("",!0)]),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-e0d5667c"]]);export{H as default};
