import{r as a,_ as e,c as l,x as t,A as r,o as s,D as d,B as o,C as _,ay as u,aI as n,ap as i,u as m,M as p,J as c,m as v,O as f,F as w,Y as j,K as g}from"./vue-vendor-CCmsYA1Y.js";import{b as h,S as b,l as y,a3 as V,N as F}from"./element-plus-BZcENYie.js";import{r as x}from"./index-CCj7ctyJ.js";import{_ as U}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./vendor-BQF3adi-.js";import"./index-BArJCJm5.js";const z={class:"invite-stats-container"},C={class:"search-section"},k={class:"card-header"},I={class:"wallet-address"},S={class:"pagination-container"},$={class:"edit-form"},K={class:"stats-section"},q={class:"adjustments-section"},A={class:"preview-section"},B={class:"preview-value"},D={class:"preview-value"},J={class:"preview-value"},M={class:"preview-value"},N={class:"preview-value"},O={class:"preview-value"},P={class:"preview-value"},R={class:"preview-value"},Y=U({__name:"InviteStats",setup(U){const Y=a(!1),E=a(!1),G=a(!1),H=a(!1),L=a(!1),Q=a(""),T=a(1),W=a(20),X=a(0),Z=a([]),aa=a({}),ea=a({real_stats:{},adjustments:{},display_stats:{}}),la=e({daily_income_adj:0,team_members_adj:0,total_recharge_adj:0,direct_members_adj:0,total_withdrawals_adj:0,total_performance_adj:0,referral_reward_adj:0,team_reward_adj:0,notes:""}),ta=l(()=>{const a=ea.value.real_stats||{};return{daily_income:(parseFloat(a.daily_income)||0)+(parseFloat(la.daily_income_adj)||0),team_members:(parseInt(a.team_members)||0)+(parseInt(la.team_members_adj)||0),total_recharge:(parseFloat(a.total_recharge)||0)+(parseFloat(la.total_recharge_adj)||0),direct_members:(parseInt(a.direct_members)||0)+(parseInt(la.direct_members_adj)||0),total_withdrawals:(parseFloat(a.total_withdrawals)||0)+(parseFloat(la.total_withdrawals_adj)||0),total_performance:(parseFloat(a.total_performance)||0)+(parseFloat(la.total_performance_adj)||0),referral_reward:(parseFloat(a.referral_reward)||0)+(parseFloat(la.referral_reward_adj)||0),team_reward:(parseFloat(a.team_reward)||0)+(parseFloat(la.team_reward_adj)||0)}}),ra=a=>a?a.length<=15?a:`${a.slice(0,6)}...${a.slice(-4)}`:"-",sa=a=>(parseFloat(a)||0).toFixed(4),da=a=>{const e=parseFloat(a)||0;return 0===e?"-":(e>0?"+":"")+e.toFixed(4)},oa=a=>{const e=parseInt(a)||0;return 0===e?"-":(e>0?"+":"")+e},_a=a=>{const e=parseFloat(a)||0;return e>0?"positive-adj":e<0?"negative-adj":"zero-adj"},ua=async()=>{var a;Y.value=!0,L.value=!1;try{const e=await x.get("/invite-stats/search",{params:{q:Q.value,page:T.value,limit:W.value}});e.success?(Z.value=e.data||[],X.value=(null==(a=e.pagination)?void 0:a.total)||0):h.error(e.message||"搜索失败")}catch(e){h.error("搜索失败: "+(e.message||"未知错误"))}finally{Y.value=!1}},na=async()=>{var a;Y.value=!0,L.value=!0;try{const e=await x.get("/invite-stats-adjusted",{params:{page:T.value,limit:W.value}});e.success?(Z.value=e.data||[],X.value=(null==(a=e.pagination)?void 0:a.total)||0):h.error(e.message||"获取失败")}catch(e){h.error("获取失败: "+(e.message||"未知错误"))}finally{Y.value=!1}},ia=a=>{ma(a)},ma=async a=>{aa.value=a,E.value=!0,G.value=!0;try{const e=await x.get(`/invite-stats/${a.wallet_address}`);if(e.success){ea.value=e.data;const a=e.data.adjustments||{};la.daily_income_adj=parseFloat(a.daily_income_adj)||0,la.team_members_adj=parseInt(a.team_members_adj)||0,la.total_recharge_adj=parseFloat(a.total_recharge_adj)||0,la.direct_members_adj=parseInt(a.direct_members_adj)||0,la.total_withdrawals_adj=parseFloat(a.total_withdrawals_adj)||0,la.total_performance_adj=parseFloat(a.total_performance_adj)||0,la.referral_reward_adj=parseFloat(a.referral_reward_adj)||0,la.team_reward_adj=parseFloat(a.team_reward_adj)||0,la.notes=a.notes||""}else h.error(e.message||"获取用户数据失败"),E.value=!1}catch(e){h.error("获取用户数据失败: "+(e.message||"未知错误")),E.value=!1}finally{G.value=!1}},pa=()=>{F.confirm("确定要重置所有调整值为0吗？","重置确认",{type:"warning"}).then(()=>{la.daily_income_adj=0,la.team_members_adj=0,la.total_recharge_adj=0,la.direct_members_adj=0,la.total_withdrawals_adj=0,la.total_performance_adj=0,la.referral_reward_adj=0,la.team_reward_adj=0,la.notes=""}).catch(()=>{})},ca=async()=>{H.value=!0;try{const a=await x.put(`/invite-stats/${aa.value.wallet_address}`,la);a.success?(h.success("保存成功"),E.value=!1,L.value?na():ua()):h.error(a.message||"保存失败")}catch(a){h.error("保存失败: "+(a.message||"未知错误"))}finally{H.value=!1}};return t(()=>{ua()}),(a,e)=>{const l=u("el-icon"),t=u("el-input"),h=u("el-button"),F=u("el-card"),x=u("el-tag"),U=u("el-table-column"),va=u("el-table"),fa=u("el-pagination"),wa=u("el-descriptions-item"),ja=u("el-descriptions"),ga=u("el-input-number"),ha=u("el-form-item"),ba=u("el-col"),ya=u("el-row"),Va=u("el-form"),Fa=u("el-dialog"),xa=n("loading");return s(),r("div",z,[e[24]||(e[24]=d("div",{class:"page-header"},[d("h1",null,"推荐数据管理"),d("p",{class:"subtitle"},"管理用户邀请页面显示的各项金额和数据")],-1)),o(F,{class:"search-card"},{default:_(()=>[d("div",C,[o(t,{modelValue:Q.value,"onUpdate:modelValue":e[0]||(e[0]=a=>Q.value=a),placeholder:"输入钱包地址搜索...",clearable:"",onKeyup:i(ua,["enter"]),class:"search-input"},{prefix:_(()=>[o(l,null,{default:_(()=>[o(m(b))]),_:1})]),_:1},8,["modelValue"]),o(h,{type:"primary",onClick:ua,loading:Y.value},{default:_(()=>[o(l,null,{default:_(()=>[o(m(b))]),_:1}),e[14]||(e[14]=p(" 搜索 ",-1))]),_:1},8,["loading"]),o(h,{onClick:na},{default:_(()=>[o(l,null,{default:_(()=>[o(m(y))]),_:1}),e[15]||(e[15]=p(" 已调整用户 ",-1))]),_:1})])]),_:1}),o(F,{class:"data-card"},{header:_(()=>[d("div",k,[d("span",null,f(L.value?"已调整用户列表":"用户列表"),1),L.value?(s(),v(x,{key:0,type:"warning",size:"small"},{default:_(()=>[...e[16]||(e[16]=[p(" 仅显示有调整值的用户 ",-1)])]),_:1})):g("",!0)])]),default:_(()=>[c((s(),v(va,{data:Z.value,stripe:"",style:{width:"100%"},onRowClick:ia},{default:_(()=>[o(U,{prop:"wallet_address",label:"钱包地址","min-width":"180"},{default:_(({row:a})=>[d("span",I,f(ra(a.wallet_address)),1)]),_:1}),o(U,{label:"每日收入调整",width:"120",align:"right"},{default:_(({row:a})=>[d("span",{class:w(_a(a.daily_income_adj))},f(da(a.daily_income_adj)),3)]),_:1}),o(U,{label:"团队成员调整",width:"120",align:"right"},{default:_(({row:a})=>[d("span",{class:w(_a(a.team_members_adj))},f(oa(a.team_members_adj)),3)]),_:1}),o(U,{label:"推荐奖励调整",width:"120",align:"right"},{default:_(({row:a})=>[d("span",{class:w(_a(a.referral_reward_adj))},f(da(a.referral_reward_adj)),3)]),_:1}),o(U,{label:"团队奖励调整",width:"120",align:"right"},{default:_(({row:a})=>[d("span",{class:w(_a(a.team_reward_adj))},f(da(a.team_reward_adj)),3)]),_:1}),o(U,{prop:"updated_by",label:"操作人",width:"100"}),o(U,{label:"操作",width:"100",fixed:"right"},{default:_(({row:a})=>[o(h,{type:"primary",link:"",onClick:j(e=>ma(a),["stop"])},{default:_(()=>[o(l,null,{default:_(()=>[o(m(V))]),_:1}),e[17]||(e[17]=p(" 编辑 ",-1))]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[xa,Y.value]]),d("div",S,[o(fa,{"current-page":T.value,"onUpdate:currentPage":e[1]||(e[1]=a=>T.value=a),"page-size":W.value,"onUpdate:pageSize":e[2]||(e[2]=a=>W.value=a),total:X.value,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:ua,onCurrentChange:ua},null,8,["current-page","page-size","total"])])]),_:1}),o(Fa,{modelValue:E.value,"onUpdate:modelValue":e[13]||(e[13]=a=>E.value=a),title:"编辑推荐数据 - "+ra(aa.value.wallet_address),width:"700px","destroy-on-close":""},{footer:_(()=>[o(h,{onClick:e[12]||(e[12]=a=>E.value=!1)},{default:_(()=>[...e[21]||(e[21]=[p("取消",-1)])]),_:1}),o(h,{type:"warning",onClick:pa},{default:_(()=>[...e[22]||(e[22]=[p("重置调整",-1)])]),_:1}),o(h,{type:"primary",onClick:ca,loading:H.value},{default:_(()=>[...e[23]||(e[23]=[p(" 保存 ",-1)])]),_:1},8,["loading"])]),default:_(()=>[c((s(),r("div",$,[d("div",K,[e[18]||(e[18]=d("h4",null,"实际数据（只读）",-1)),o(ja,{column:2,border:"",size:"small"},{default:_(()=>[o(wa,{label:"每日总收入"},{default:_(()=>{var a;return[p(f(sa(null==(a=ea.value.real_stats)?void 0:a.daily_income)),1)]}),_:1}),o(wa,{label:"团队成员"},{default:_(()=>{var a;return[p(f((null==(a=ea.value.real_stats)?void 0:a.team_members)||0),1)]}),_:1}),o(wa,{label:"社区充值"},{default:_(()=>{var a;return[p(f(sa(null==(a=ea.value.real_stats)?void 0:a.total_recharge)),1)]}),_:1}),o(wa,{label:"直推成员"},{default:_(()=>{var a;return[p(f((null==(a=ea.value.real_stats)?void 0:a.direct_members)||0),1)]}),_:1}),o(wa,{label:"社区提现"},{default:_(()=>{var a;return[p(f(sa(null==(a=ea.value.real_stats)?void 0:a.total_withdrawals)),1)]}),_:1}),o(wa,{label:"社区业绩"},{default:_(()=>{var a;return[p(f(sa(null==(a=ea.value.real_stats)?void 0:a.total_performance)),1)]}),_:1}),o(wa,{label:"推荐奖励"},{default:_(()=>{var a;return[p(f(sa(null==(a=ea.value.real_stats)?void 0:a.referral_reward)),1)]}),_:1}),o(wa,{label:"团队奖励"},{default:_(()=>{var a;return[p(f(sa(null==(a=ea.value.real_stats)?void 0:a.team_reward)),1)]}),_:1})]),_:1})]),d("div",q,[e[19]||(e[19]=d("h4",null,"调整值设置（正数增加，负数减少）",-1)),o(Va,{model:la,"label-width":"120px",size:"default"},{default:_(()=>[o(ya,{gutter:20},{default:_(()=>[o(ba,{span:12},{default:_(()=>[o(ha,{label:"每日收入"},{default:_(()=>[o(ga,{modelValue:la.daily_income_adj,"onUpdate:modelValue":e[3]||(e[3]=a=>la.daily_income_adj=a),precision:4,step:10,"controls-position":"right"},null,8,["modelValue"])]),_:1})]),_:1}),o(ba,{span:12},{default:_(()=>[o(ha,{label:"团队成员"},{default:_(()=>[o(ga,{modelValue:la.team_members_adj,"onUpdate:modelValue":e[4]||(e[4]=a=>la.team_members_adj=a),precision:0,step:1,"controls-position":"right"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),o(ya,{gutter:20},{default:_(()=>[o(ba,{span:12},{default:_(()=>[o(ha,{label:"社区充值"},{default:_(()=>[o(ga,{modelValue:la.total_recharge_adj,"onUpdate:modelValue":e[5]||(e[5]=a=>la.total_recharge_adj=a),precision:4,step:100,"controls-position":"right"},null,8,["modelValue"])]),_:1})]),_:1}),o(ba,{span:12},{default:_(()=>[o(ha,{label:"直推成员"},{default:_(()=>[o(ga,{modelValue:la.direct_members_adj,"onUpdate:modelValue":e[6]||(e[6]=a=>la.direct_members_adj=a),precision:0,step:1,"controls-position":"right"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),o(ya,{gutter:20},{default:_(()=>[o(ba,{span:12},{default:_(()=>[o(ha,{label:"社区提现"},{default:_(()=>[o(ga,{modelValue:la.total_withdrawals_adj,"onUpdate:modelValue":e[7]||(e[7]=a=>la.total_withdrawals_adj=a),precision:4,step:100,"controls-position":"right"},null,8,["modelValue"])]),_:1})]),_:1}),o(ba,{span:12},{default:_(()=>[o(ha,{label:"社区业绩"},{default:_(()=>[o(ga,{modelValue:la.total_performance_adj,"onUpdate:modelValue":e[8]||(e[8]=a=>la.total_performance_adj=a),precision:4,step:100,"controls-position":"right"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),o(ya,{gutter:20},{default:_(()=>[o(ba,{span:12},{default:_(()=>[o(ha,{label:"推荐奖励"},{default:_(()=>[o(ga,{modelValue:la.referral_reward_adj,"onUpdate:modelValue":e[9]||(e[9]=a=>la.referral_reward_adj=a),precision:4,step:10,"controls-position":"right"},null,8,["modelValue"])]),_:1})]),_:1}),o(ba,{span:12},{default:_(()=>[o(ha,{label:"团队奖励"},{default:_(()=>[o(ga,{modelValue:la.team_reward_adj,"onUpdate:modelValue":e[10]||(e[10]=a=>la.team_reward_adj=a),precision:4,step:10,"controls-position":"right"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),o(ha,{label:"备注"},{default:_(()=>[o(t,{modelValue:la.notes,"onUpdate:modelValue":e[11]||(e[11]=a=>la.notes=a),type:"textarea",rows:2,placeholder:"输入调整原因或备注..."},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),d("div",A,[e[20]||(e[20]=d("h4",null,"预览显示效果",-1)),o(ja,{column:2,border:"",size:"small",class:"preview-desc"},{default:_(()=>[o(wa,{label:"每日总收入"},{default:_(()=>[d("span",B,f(sa(ta.value.daily_income)),1)]),_:1}),o(wa,{label:"团队成员"},{default:_(()=>[d("span",D,f(ta.value.team_members),1)]),_:1}),o(wa,{label:"社区充值"},{default:_(()=>[d("span",J,f(sa(ta.value.total_recharge)),1)]),_:1}),o(wa,{label:"直推成员"},{default:_(()=>[d("span",M,f(ta.value.direct_members),1)]),_:1}),o(wa,{label:"社区提现"},{default:_(()=>[d("span",N,f(sa(ta.value.total_withdrawals)),1)]),_:1}),o(wa,{label:"社区业绩"},{default:_(()=>[d("span",O,f(sa(ta.value.total_performance)),1)]),_:1}),o(wa,{label:"推荐奖励"},{default:_(()=>[d("span",P,f(sa(ta.value.referral_reward)),1)]),_:1}),o(wa,{label:"团队奖励"},{default:_(()=>[d("span",R,f(sa(ta.value.team_reward)),1)]),_:1})]),_:1})])])),[[xa,G.value]])]),_:1},8,["modelValue","title"])])}}},[["__scopeId","data-v-c97a364d"]]);export{Y as default};
