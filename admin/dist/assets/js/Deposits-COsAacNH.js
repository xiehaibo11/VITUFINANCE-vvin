import{r as e,_ as a,x as t,V as l,A as s,o as n,D as d,J as o,B as r,C as i,Y as p,ay as u,aI as c,m,M as g,u as _,O as f,K as h,P as w}from"./vue-vendor-CCmsYA1Y.js";import{S as y,I as v,T as b,b as k,N as x}from"./element-plus-BZcENYie.js";import{bC as z}from"./vendor-BQF3adi-.js";import{h as C,i as S}from"./index-CQDoFXMh.js";import{e as R,E as V}from"./eventBus-DOIgU4mI.js";import{_ as Y}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./index-Gc17XYwO.js";const j={class:"page-container"},D={class:"search-area"},$=["onClick"],E={class:"amount positive"},I=["onClick"],M={key:1,class:"no-data"},U={class:"pagination-wrapper"},F=Y({__name:"Deposits",setup(Y){const F=e(!1),H=e([]),P=a({wallet_address:"",status:"",dateRange:null}),T=a({page:1,pageSize:10,total:0}),O=async()=>{F.value=!0;try{const e={page:T.page,pageSize:T.pageSize,wallet_address:P.wallet_address||void 0,status:P.status||void 0};P.dateRange&&(e.start_date=P.dateRange[0],e.end_date=P.dateRange[1]);const a=await C(e);a.success&&(H.value=a.data.list||[],T.total=a.data.total||0)}catch(e){}finally{F.value=!1}},A=()=>{T.page=1,O()},B=()=>{P.wallet_address="",P.status="",P.dateRange=null,T.page=1,O()},J=()=>{T.page=1,O()},K=()=>{O()},N=e=>{navigator.clipboard.writeText(e),k.success("已复制")},q=e=>z(e).format("YYYY-MM-DD HH:mm:ss"),G=e=>({pending:"待处理",completed:"已完成",failed:"失败"}[e]||e),L=()=>{O()};return t(()=>{O(),R.on(V.REFRESH_DEPOSITS,L)}),l(()=>{R.off(V.REFRESH_DEPOSITS,L)}),(e,a)=>{const t=u("el-input"),l=u("el-form-item"),z=u("el-option"),C=u("el-select"),R=u("el-date-picker"),V=u("el-icon"),Y=u("el-button"),L=u("el-form"),Q=u("el-table-column"),W=u("el-tooltip"),X=u("el-tag"),Z=u("el-table"),ee=u("el-pagination"),ae=c("loading");return n(),s("div",j,[a[11]||(a[11]=d("div",{class:"page-header"},[d("h2",null,"充值记录"),d("p",{class:"description"},"查看和管理所有用户的充值记录")],-1)),d("div",D,[r(L,{inline:!0,model:P,onSubmit:p(A,["prevent"])},{default:i(()=>[r(l,{label:"钱包地址"},{default:i(()=>[r(t,{modelValue:P.wallet_address,"onUpdate:modelValue":a[0]||(a[0]=e=>P.wallet_address=e),placeholder:"请输入钱包地址",clearable:"",style:{width:"280px"}},null,8,["modelValue"])]),_:1}),r(l,{label:"状态"},{default:i(()=>[r(C,{modelValue:P.status,"onUpdate:modelValue":a[1]||(a[1]=e=>P.status=e),placeholder:"全部",clearable:"",style:{width:"120px"}},{default:i(()=>[r(z,{label:"待处理",value:"pending"}),r(z,{label:"已完成",value:"completed"}),r(z,{label:"失败",value:"failed"})]),_:1},8,["modelValue"])]),_:1}),r(l,{label:"时间范围"},{default:i(()=>[r(R,{modelValue:P.dateRange,"onUpdate:modelValue":a[2]||(a[2]=e=>P.dateRange=e),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD",style:{width:"260px"}},null,8,["modelValue"])]),_:1}),r(l,null,{default:i(()=>[r(Y,{type:"primary",onClick:A},{default:i(()=>[r(V,null,{default:i(()=>[r(_(y))]),_:1}),a[5]||(a[5]=g(" 搜索 ",-1))]),_:1}),r(Y,{onClick:B},{default:i(()=>[r(V,null,{default:i(()=>[r(_(v))]),_:1}),a[6]||(a[6]=g(" 重置 ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),o((n(),m(Z,{data:H.value,stripe:"",border:"",style:{width:"100%"}},{default:i(()=>[r(Q,{type:"index",label:"序号",width:"60",align:"center"}),r(Q,{prop:"wallet_address",label:"钱包地址","min-width":"180"},{default:i(({row:e})=>[r(W,{content:e.wallet_address,placement:"top"},{default:i(()=>{return[d("span",{class:"wallet-address",onClick:a=>N(e.wallet_address)},f((a=e.wallet_address,a?`${a.slice(0,8)}...${a.slice(-6)}`:"")),9,$)];var a}),_:2},1032,["content"])]),_:1}),r(Q,{prop:"amount",label:"充值金额",width:"130",align:"right"},{default:i(({row:e})=>{return[d("span",E,"+"+f((a=e.amount,parseFloat(a||0).toFixed(4)))+" "+f(e.token),1)];var a}),_:1}),r(Q,{prop:"tx_hash",label:"交易哈希","min-width":"180"},{default:i(({row:e})=>[e.tx_hash?(n(),m(W,{key:0,content:e.tx_hash,placement:"top"},{default:i(()=>{return[d("span",{class:"tx-hash",onClick:a=>N(e.tx_hash)},[g(f((a=e.tx_hash,a?`${a.slice(0,10)}...${a.slice(-8)}`:""))+" ",1),r(V,null,{default:i(()=>[r(_(b))]),_:1})],8,I)];var a}),_:2},1032,["content"])):(n(),s("span",M,"-"))]),_:1}),r(Q,{prop:"status",label:"状态",width:"100",align:"center"},{default:i(({row:e})=>{return[r(X,{type:(a=e.status,{pending:"warning",completed:"success",failed:"danger"}[a]||"info"),size:"small"},{default:i(()=>[g(f(G(e.status)),1)]),_:2},1032,["type"])];var a}),_:1}),r(Q,{prop:"created_at",label:"创建时间",width:"170"},{default:i(({row:e})=>[g(f(q(e.created_at)),1)]),_:1}),r(Q,{prop:"completed_at",label:"完成时间",width:"170"},{default:i(({row:e})=>[g(f(e.completed_at?q(e.completed_at):"-"),1)]),_:1}),r(Q,{label:"操作",width:"150",fixed:"right",align:"center"},{default:i(({row:e})=>["pending"===e.status?(n(),s(w,{key:0},[r(Y,{type:"success",link:"",size:"small",onClick:a=>(async e=>{try{await x.confirm(`确定将此充值记录标记为已完成吗？\n金额：${e.amount} ${e.token}`,"确认操作",{type:"warning"});const a=await S(e.id,"completed");a.success?(k.success("操作成功"),O()):k.error(a.message||"操作失败")}catch{}})(e)},{default:i(()=>[...a[7]||(a[7]=[g(" 确认完成 ",-1)])]),_:1},8,["onClick"]),r(Y,{type:"danger",link:"",size:"small",onClick:a=>(async e=>{try{await x.confirm(`确定将此充值记录标记为失败吗？\n金额：${e.amount} ${e.token}`,"确认操作",{type:"warning"});const a=await S(e.id,"failed");a.success?(k.success("操作成功"),O()):k.error(a.message||"操作失败")}catch{}})(e)},{default:i(()=>[...a[8]||(a[8]=[g(" 标记失败 ",-1)])]),_:1},8,["onClick"])],64)):"completed"===e.status?(n(),m(X,{key:1,type:"success",size:"small"},{default:i(()=>[...a[9]||(a[9]=[g("已处理",-1)])]),_:1})):"failed"===e.status?(n(),m(X,{key:2,type:"danger",size:"small"},{default:i(()=>[...a[10]||(a[10]=[g("已失败",-1)])]),_:1})):h("",!0)]),_:1})]),_:1},8,["data"])),[[ae,F.value]]),d("div",U,[r(ee,{"current-page":T.page,"onUpdate:currentPage":a[3]||(a[3]=e=>T.page=e),"page-size":T.pageSize,"onUpdate:pageSize":a[4]||(a[4]=e=>T.pageSize=e),"page-sizes":[10,20,50,100],total:T.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:J,onCurrentChange:K},null,8,["current-page","page-size","total"])])])}}},[["__scopeId","data-v-e92d12d1"]]);export{F as default};
