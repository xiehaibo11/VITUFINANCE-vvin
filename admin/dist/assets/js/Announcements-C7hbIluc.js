import{V as e,N as t,b as a}from"./element-plus-BZcENYie.js";import{bC as l}from"./vendor-BQF3adi-.js";import{w as s,x as o,y as r,z as i}from"./index-CCj7ctyJ.js";import{_ as n}from"./_plugin-vue_export-helper-BCo6x5W8.js";import{r as u,_ as d,x as c,A as p,o as m,D as g,J as _,B as f,C as v,ay as w,aI as y,m as h,M as b,u as x,O as z}from"./vue-vendor-CCmsYA1Y.js";import"./index-BArJCJm5.js";const V={class:"page-container"},C={class:"table-toolbar"},k={class:"title-text"},j={class:"pagination-wrapper"},S=n({__name:"Announcements",setup(n){const S=u(!1),U=u(!1),Y=u([]),D=d({page:1,pageSize:10,total:0}),M=u(!1),A=u(!1),H=u(null),I=d({id:null,title:"",content:"",sort_order:0,status:"active"}),$={title:[{required:!0,message:"请输入公告标题",trigger:"blur"},{max:500,message:"标题不能超过500个字符",trigger:"blur"}]},q=async()=>{S.value=!0;try{const e=await s({page:D.page,pageSize:D.pageSize});e.success&&(Y.value=e.data.list||[],D.total=e.data.total||0)}catch(e){}finally{S.value=!1}},B=()=>{D.page=1,q()},J=()=>{q()},N=()=>{A.value=!1,I.id=null,I.title="",I.content="",I.sort_order=0,I.status="active",M.value=!0},O=async()=>{if(await H.value.validate().catch(()=>!1)){U.value=!0;try{let e;e=A.value?await o(I.id,{title:I.title,content:I.content,sort_order:I.sort_order,status:I.status}):await i({title:I.title,content:I.content,sort_order:I.sort_order,status:I.status}),e.success?(a.success(A.value?"更新成功":"创建成功"),M.value=!1,q()):a.error(e.message||"操作失败")}catch(e){}finally{U.value=!1}}},P=e=>l(e).format("YYYY-MM-DD HH:mm:ss");return c(()=>{q()}),(l,s)=>{const i=w("el-icon"),n=w("el-button"),u=w("el-table-column"),d=w("el-tooltip"),c=w("el-tag"),R=w("el-table"),E=w("el-pagination"),F=w("el-input"),G=w("el-form-item"),K=w("el-input-number"),L=w("el-radio"),Q=w("el-radio-group"),T=w("el-form"),W=w("el-dialog"),X=y("loading");return m(),p("div",V,[s[15]||(s[15]=g("div",{class:"page-header"},[g("h2",null,"公告管理"),g("p",{class:"description"},"管理平台公告，支持创建、编辑和删除公告")],-1)),g("div",C,[f(n,{type:"primary",onClick:N},{default:v(()=>[f(i,null,{default:v(()=>[f(x(e))]),_:1}),s[8]||(s[8]=b(" 新增公告 ",-1))]),_:1})]),_((m(),h(R,{data:Y.value,stripe:"",border:"",style:{width:"100%"}},{default:v(()=>[f(u,{type:"index",label:"序号",width:"60",align:"center"}),f(u,{prop:"title",label:"公告标题","min-width":"300"},{default:v(({row:e})=>[f(d,{content:e.title,placement:"top",disabled:e.title.length<50},{default:v(()=>[g("span",k,z(e.title),1)]),_:2},1032,["content","disabled"])]),_:1}),f(u,{prop:"status",label:"状态",width:"100",align:"center"},{default:v(({row:e})=>[f(c,{type:"active"===e.status?"success":"info",size:"small"},{default:v(()=>[b(z("active"===e.status?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),f(u,{prop:"sort_order",label:"排序",width:"80",align:"center"}),f(u,{prop:"created_at",label:"创建时间",width:"170"},{default:v(({row:e})=>[b(z(P(e.created_at)),1)]),_:1}),f(u,{prop:"updated_at",label:"更新时间",width:"170"},{default:v(({row:e})=>[b(z(P(e.updated_at)),1)]),_:1}),f(u,{label:"操作",width:"200",fixed:"right",align:"center"},{default:v(({row:e})=>[f(n,{type:"primary",link:"",size:"small",onClick:t=>(e=>{A.value=!0,I.id=e.id,I.title=e.title,I.content=e.content||"",I.sort_order=e.sort_order||0,I.status=e.status,M.value=!0})(e)},{default:v(()=>[...s[9]||(s[9]=[b(" 编辑 ",-1)])]),_:1},8,["onClick"]),f(n,{type:"active"===e.status?"warning":"success",link:"",size:"small",onClick:l=>(async e=>{const l="active"===e.status?"inactive":"active",s="active"===l?"启用":"禁用";try{await t.confirm(`确定${s}此公告吗？`,"确认操作",{type:"warning"});const r=await o(e.id,{status:l});r.success?(a.success(`已${s}`),q()):a.error(r.message||"操作失败")}catch{}})(e)},{default:v(()=>[b(z("active"===e.status?"禁用":"启用"),1)]),_:2},1032,["type","onClick"]),f(n,{type:"danger",link:"",size:"small",onClick:l=>(async e=>{try{await t.confirm("确定删除此公告吗？此操作不可恢复","确认删除",{type:"warning"});const l=await r(e.id);l.success?(a.success("删除成功"),q()):a.error(l.message||"删除失败")}catch{}})(e)},{default:v(()=>[...s[10]||(s[10]=[b(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[X,S.value]]),g("div",j,[f(E,{"current-page":D.page,"onUpdate:currentPage":s[0]||(s[0]=e=>D.page=e),"page-size":D.pageSize,"onUpdate:pageSize":s[1]||(s[1]=e=>D.pageSize=e),"page-sizes":[10,20,50,100],total:D.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:B,onCurrentChange:J},null,8,["current-page","page-size","total"])]),f(W,{modelValue:M.value,"onUpdate:modelValue":s[7]||(s[7]=e=>M.value=e),title:A.value?"编辑公告":"新增公告",width:"600px","destroy-on-close":""},{footer:v(()=>[f(n,{onClick:s[6]||(s[6]=e=>M.value=!1)},{default:v(()=>[...s[13]||(s[13]=[b("取消",-1)])]),_:1}),f(n,{type:"primary",loading:U.value,onClick:O},{default:v(()=>[...s[14]||(s[14]=[b(" 确定 ",-1)])]),_:1},8,["loading"])]),default:v(()=>[f(T,{ref_key:"formRef",ref:H,model:I,rules:$,"label-width":"80px"},{default:v(()=>[f(G,{label:"标题",prop:"title"},{default:v(()=>[f(F,{modelValue:I.title,"onUpdate:modelValue":s[2]||(s[2]=e=>I.title=e),placeholder:"请输入公告标题",maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),_:1}),f(G,{label:"内容",prop:"content"},{default:v(()=>[f(F,{modelValue:I.content,"onUpdate:modelValue":s[3]||(s[3]=e=>I.content=e),type:"textarea",rows:6,placeholder:"请输入公告内容（可选）"},null,8,["modelValue"])]),_:1}),f(G,{label:"排序",prop:"sort_order"},{default:v(()=>[f(K,{modelValue:I.sort_order,"onUpdate:modelValue":s[4]||(s[4]=e=>I.sort_order=e),min:0,max:9999,placeholder:"数字越大越靠前"},null,8,["modelValue"])]),_:1}),f(G,{label:"状态",prop:"status"},{default:v(()=>[f(Q,{modelValue:I.status,"onUpdate:modelValue":s[5]||(s[5]=e=>I.status=e)},{default:v(()=>[f(L,{value:"active"},{default:v(()=>[...s[11]||(s[11]=[b("启用",-1)])]),_:1}),f(L,{value:"inactive"},{default:v(()=>[...s[12]||(s[12]=[b("禁用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},[["__scopeId","data-v-20d7df49"]]);export{S as default};
