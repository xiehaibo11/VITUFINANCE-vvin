import{r as e,_ as a,x as t,V as l,A as s,o as n,D as o,J as d,B as r,C as i,Y as u,ay as c,aI as p,m,M as _,u as g,O as h,K as f,P as w}from"./vue-vendor-CCmsYA1Y.js";import{S as k,I as y,b as x,N as b}from"./element-plus-BZcENYie.js";import{e as v,E as C}from"./eventBus-DOIgU4mI.js";import{bC as z}from"./vendor-BQF3adi-.js";import{j as V,p as $}from"./index-DcuAk0vn.js";import{_ as R}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./index-BxKU4Ero.js";const S={class:"page-container"},j={class:"search-area"},U=["onClick"],Y={class:"amount negative"},D={class:"fee-amount"},A={class:"actual-amount"},E=["onClick"],F=["onClick"],H={key:1,class:"no-data"},M={class:"pagination-wrapper"},T={class:"amount"},I={class:"fee-amount"},W={class:"actual-amount"},B={class:"wallet-address"},P=R({__name:"Withdrawals",setup(R){const P=e(!1),L=e(!1),q=e([]),J=a({wallet_address:"",status:"",dateRange:null}),K=a({page:1,pageSize:10,total:0}),N=e(!1),O=e(null),G=a({id:0,amount:0,token:"USDT",to_address:"",tx_hash:"",remark:""}),Q={tx_hash:[{required:!0,message:"请输入交易哈希",trigger:"blur"}]},X=async()=>{P.value=!0;try{const e={page:K.page,pageSize:K.pageSize,wallet_address:J.wallet_address||void 0,status:J.status||void 0};J.dateRange&&(e.start_date=J.dateRange[0],e.end_date=J.dateRange[1]);const a=await V(e);a.success&&(q.value=a.data.list||[],K.total=a.data.total||0)}catch(e){}finally{P.value=!1}},Z=()=>{K.page=1,X()},ee=()=>{J.wallet_address="",J.status="",J.dateRange=null,K.page=1,X()},ae=()=>{K.page=1,X()},te=()=>{X()},le=async()=>{if(await O.value.validate().catch(()=>!1)){L.value=!0;try{const e=await $(G.id,{status:"processing",tx_hash:G.tx_hash,remark:G.remark});e.success?(x.success("处理成功"),N.value=!1,X()):x.error(e.message||"处理失败")}catch(e){}finally{L.value=!1}}},se=e=>{navigator.clipboard.writeText(e),x.success("已复制")},ne=e=>e?`${e.slice(0,8)}...${e.slice(-6)}`:"",oe=e=>e?`${e.slice(0,10)}...${e.slice(-8)}`:"",de=e=>parseFloat(e||0).toFixed(4),re=e=>({pending:"待处理",processing:"处理中",completed:"已完成",failed:"失败"}[e]||e),ie=()=>{X()};return t(()=>{X(),v.on(C.REFRESH_WITHDRAWALS,ie)}),l(()=>{v.off(C.REFRESH_WITHDRAWALS,ie)}),(e,a)=>{const t=c("el-input"),l=c("el-form-item"),v=c("el-option"),C=c("el-select"),V=c("el-date-picker"),R=c("el-icon"),ie=c("el-button"),ue=c("el-form"),ce=c("el-table-column"),pe=c("el-tooltip"),me=c("el-tag"),_e=c("el-table"),ge=c("el-pagination"),he=c("el-dialog"),fe=p("loading");return n(),s("div",S,[a[19]||(a[19]=o("div",{class:"page-header"},[o("h2",null,"提款记录"),o("p",{class:"description"},"查看和处理所有用户的提款申请")],-1)),o("div",j,[r(ue,{inline:!0,model:J,onSubmit:u(Z,["prevent"])},{default:i(()=>[r(l,{label:"钱包地址"},{default:i(()=>[r(t,{modelValue:J.wallet_address,"onUpdate:modelValue":a[0]||(a[0]=e=>J.wallet_address=e),placeholder:"请输入钱包地址",clearable:"",style:{width:"280px"}},null,8,["modelValue"])]),_:1}),r(l,{label:"状态"},{default:i(()=>[r(C,{modelValue:J.status,"onUpdate:modelValue":a[1]||(a[1]=e=>J.status=e),placeholder:"全部",clearable:"",style:{width:"120px"}},{default:i(()=>[r(v,{label:"待处理",value:"pending"}),r(v,{label:"处理中",value:"processing"}),r(v,{label:"已完成",value:"completed"}),r(v,{label:"失败",value:"failed"})]),_:1},8,["modelValue"])]),_:1}),r(l,{label:"时间范围"},{default:i(()=>[r(V,{modelValue:J.dateRange,"onUpdate:modelValue":a[2]||(a[2]=e=>J.dateRange=e),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD",style:{width:"260px"}},null,8,["modelValue"])]),_:1}),r(l,null,{default:i(()=>[r(ie,{type:"primary",onClick:Z},{default:i(()=>[r(R,null,{default:i(()=>[r(g(k))]),_:1}),a[9]||(a[9]=_(" 搜索 ",-1))]),_:1}),r(ie,{onClick:ee},{default:i(()=>[r(R,null,{default:i(()=>[r(g(y))]),_:1}),a[10]||(a[10]=_(" 重置 ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),d((n(),m(_e,{data:q.value,stripe:"",border:"",style:{width:"100%"}},{default:i(()=>[r(ce,{type:"index",label:"序号",width:"60",align:"center"}),r(ce,{prop:"wallet_address",label:"钱包地址","min-width":"160"},{default:i(({row:e})=>[r(pe,{content:e.wallet_address,placement:"top"},{default:i(()=>[o("span",{class:"wallet-address",onClick:a=>se(e.wallet_address)},h(ne(e.wallet_address)),9,U)]),_:2},1032,["content"])]),_:1}),r(ce,{prop:"amount",label:"提款金额",width:"120",align:"right"},{default:i(({row:e})=>[o("span",Y,h(de(e.amount))+" "+h(e.token),1)]),_:1}),r(ce,{prop:"fee",label:"手续费(0.5%)",width:"110",align:"right"},{default:i(({row:e})=>[o("span",D,h(de(e.fee||.005*e.amount))+" "+h(e.token),1)]),_:1}),r(ce,{prop:"actual_amount",label:"实际到账",width:"120",align:"right"},{default:i(({row:e})=>[o("span",A,h(de(e.actual_amount||.995*e.amount))+" "+h(e.token),1)]),_:1}),r(ce,{prop:"to_address",label:"接收地址","min-width":"160"},{default:i(({row:e})=>[r(pe,{content:e.to_address,placement:"top"},{default:i(()=>[o("span",{class:"wallet-address",onClick:a=>se(e.to_address)},h(ne(e.to_address)),9,E)]),_:2},1032,["content"])]),_:1}),r(ce,{prop:"tx_hash",label:"交易哈希","min-width":"150"},{default:i(({row:e})=>[e.tx_hash?(n(),m(pe,{key:0,content:e.tx_hash,placement:"top"},{default:i(()=>[o("span",{class:"tx-hash",onClick:a=>se(e.tx_hash)},h(oe(e.tx_hash)),9,F)]),_:2},1032,["content"])):(n(),s("span",H,"-"))]),_:1}),r(ce,{prop:"status",label:"状态",width:"100",align:"center"},{default:i(({row:e})=>{return[r(me,{type:(a=e.status,{pending:"warning",processing:"info",completed:"success",failed:"danger"}[a]||"info"),size:"small"},{default:i(()=>[_(h(re(e.status)),1)]),_:2},1032,["type"])];var a}),_:1}),r(ce,{prop:"created_at",label:"申请时间",width:"160"},{default:i(({row:e})=>{return[_(h((a=e.created_at,z(a).format("YYYY-MM-DD HH:mm:ss"))),1)];var a}),_:1}),r(ce,{label:"操作",width:"200",fixed:"right",align:"center"},{default:i(({row:e})=>["pending"===e.status?(n(),s(w,{key:0},[r(ie,{type:"primary",link:"",size:"small",onClick:a=>(e=>{G.id=e.id,G.amount=e.amount,G.token=e.token,G.to_address=e.to_address,G.tx_hash="",G.remark="",N.value=!0})(e)},{default:i(()=>[...a[11]||(a[11]=[_(" 处理 ",-1)])]),_:1},8,["onClick"]),r(ie,{type:"danger",link:"",size:"small",onClick:a=>(async e=>{try{await b.confirm(`确定拒绝此提款申请吗？\n金额：${e.amount} ${e.token}\n余额将退回用户账户`,"确认拒绝",{type:"warning"});const a=await $(e.id,{status:"failed",action:"reject"});a.success?(x.success("已拒绝"),X()):x.error(a.message||"操作失败")}catch{}})(e)},{default:i(()=>[...a[12]||(a[12]=[_(" 拒绝 ",-1)])]),_:1},8,["onClick"])],64)):"processing"===e.status?(n(),s(w,{key:1},[r(ie,{type:"success",link:"",size:"small",onClick:a=>(async e=>{try{if(e.tx_hash&&"。"!==e.tx_hash){await b.confirm(`确定将此提款标记为已完成吗？\n金额：${e.amount} ${e.token}\n交易哈希：${oe(e.tx_hash)}`,"确认完成",{type:"success"});const a=await $(e.id,{status:"completed"});a.success?(x.success("已完成"),X()):x.error(a.message||"操作失败")}else{const{value:a}=await b.prompt(`请输入提款交易哈希\n金额：${e.amount} ${e.token}\n地址：${ne(e.wallet_address)}`,"完成提款",{confirmButtonText:"确认完成",cancelButtonText:"取消",inputPattern:/^0x[a-fA-F0-9]{64}$/,inputErrorMessage:"请输入有效的交易哈希 (0x开头的66位十六进制)",inputPlaceholder:"0x..."}),t=await $(e.id,{status:"completed",tx_hash:a});t.success?(x.success("已完成"),X()):x.error(t.message||"操作失败")}}catch{}})(e)},{default:i(()=>[...a[13]||(a[13]=[_(" 完成 ",-1)])]),_:1},8,["onClick"]),r(ie,{type:"danger",link:"",size:"small",onClick:a=>(async e=>{try{await b.confirm(`确定将此提款标记为失败吗？\n金额：${e.amount} ${e.token}\n余额将退回用户账户`,"确认失败",{type:"warning"});const a=await $(e.id,{status:"failed"});a.success?(x.success("已标记失败"),X()):x.error(a.message||"操作失败")}catch{}})(e)},{default:i(()=>[...a[14]||(a[14]=[_(" 失败 ",-1)])]),_:1},8,["onClick"])],64)):"failed"===e.status?(n(),m(ie,{key:2,type:"warning",link:"",size:"small",onClick:a=>(async e=>{try{await b.confirm(`确定重新处理此提款申请吗？\n金额：${e.amount} ${e.token}\n状态将改为"待处理"`,"重新处理",{type:"warning"});const a=await $(e.id,{status:"pending"});a.success?(x.success("已重新提交处理"),X()):x.error(a.message||"操作失败")}catch{}})(e)},{default:i(()=>[...a[15]||(a[15]=[_(" 重新处理 ",-1)])]),_:1},8,["onClick"])):"completed"===e.status?(n(),m(ie,{key:3,type:"info",link:"",size:"small",onClick:a=>(e=>{e.tx_hash?window.open(`https://bscscan.com/tx/${e.tx_hash}`,"_blank"):x.warning("该交易没有链上哈希")})(e)},{default:i(()=>[...a[16]||(a[16]=[_(" 查看交易 ",-1)])]),_:1},8,["onClick"])):f("",!0)]),_:1})]),_:1},8,["data"])),[[fe,P.value]]),o("div",M,[r(ge,{"current-page":K.page,"onUpdate:currentPage":a[3]||(a[3]=e=>K.page=e),"page-size":K.pageSize,"onUpdate:pageSize":a[4]||(a[4]=e=>K.pageSize=e),"page-sizes":[10,20,50,100],total:K.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:ae,onCurrentChange:te},null,8,["current-page","page-size","total"])]),r(he,{modelValue:N.value,"onUpdate:modelValue":a[8]||(a[8]=e=>N.value=e),title:"处理提款申请",width:"500px","destroy-on-close":""},{footer:i(()=>[r(ie,{onClick:a[7]||(a[7]=e=>N.value=!1)},{default:i(()=>[...a[17]||(a[17]=[_("取消",-1)])]),_:1}),r(ie,{type:"primary",loading:L.value,onClick:le},{default:i(()=>[...a[18]||(a[18]=[_(" 确认处理 ",-1)])]),_:1},8,["loading"])]),default:i(()=>[r(ue,{ref_key:"processFormRef",ref:O,model:G,rules:Q,"label-width":"100px"},{default:i(()=>[r(l,{label:"提款金额"},{default:i(()=>[o("span",T,h(de(G.amount))+" "+h(G.token),1)]),_:1}),r(l,{label:"手续费(0.5%)"},{default:i(()=>[o("span",I,h(de(.005*G.amount))+" "+h(G.token),1)]),_:1}),r(l,{label:"实际到账"},{default:i(()=>[o("span",W,h(de(.995*G.amount))+" "+h(G.token),1)]),_:1}),r(l,{label:"接收地址"},{default:i(()=>[o("span",B,h(G.to_address),1)]),_:1}),r(l,{label:"交易哈希",prop:"tx_hash"},{default:i(()=>[r(t,{modelValue:G.tx_hash,"onUpdate:modelValue":a[5]||(a[5]=e=>G.tx_hash=e),placeholder:"请输入转账后的交易哈希"},null,8,["modelValue"])]),_:1}),r(l,{label:"备注",prop:"remark"},{default:i(()=>[r(t,{modelValue:G.remark,"onUpdate:modelValue":a[6]||(a[6]=e=>G.remark=e),type:"textarea",rows:3,placeholder:"可选备注"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-4ba49b5b"]]);export{P as default};
