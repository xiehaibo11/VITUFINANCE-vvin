import{r as e,_ as a,x as l,V as t,A as s,o as i,D as d,B as o,C as r,ay as c,aI as u,M as n,u as p,O as v,J as m,m as f,ap as _}from"./vue-vendor-CCmsYA1Y.js";import{I as b,x as y,V as w,N as h,b as g}from"./element-plus-BZcENYie.js";import{r as k}from"./index-DcuAk0vn.js";import{bC as I}from"./vendor-BQF3adi-.js";import{_ as P}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./index-BxKU4Ero.js";const V={class:"ip-blacklist-page"},x={class:"page-header"},C={class:"header-actions"},U={class:"stats-cards"},z={class:"stat-info"},j={class:"stat-value"},q={class:"stat-info"},$={class:"stat-value"},A={class:"stat-info"},S={class:"stat-value"},D={class:"stat-info"},Y={class:"stat-value"},M={class:"ip-address"},B={key:1,class:"remaining-time"},H={class:"ip-address"},L={class:"request-path"},Q={class:"pagination-wrapper"},T={class:"whitelist-header"},X={class:"ip-address"},J=P({__name:"IPBlacklist",setup(P){const J=e(!1),K=e(!1),N=e(!1),O=e(!1),R=e(!1),E=e("blocked"),F=a({blockedIPs:0,todayAttacks:0,criticalAttacks:0,trackedIPs:0}),G=e([]),W=e([]),Z=e(1),ee=e(0),ae=a({type:"",severity:"",ip:""}),le=e([]),te=e(!1),se=e(!1),ie=a({ip:"",duration:36e5,reason:""}),de=a({ip:"",description:""});let oe=null;const re=async()=>{var e,a,l,t,s;try{const i=await k.get("/security/stats");if(i.success){const d=i.data;F.blockedIPs=(null==(e=d.ipProtection)?void 0:e.blockedIPs)||0,F.trackedIPs=(null==(a=d.ipProtection)?void 0:a.trackedIPs)||0,F.todayAttacks=(null==(l=d.attacks)?void 0:l.total)||0,F.criticalAttacks=((null==(t=d.attacks)?void 0:t.critical)||0)+((null==(s=d.attacks)?void 0:s.high)||0)}}catch(i){}},ce=async()=>{J.value=!0;try{const e=await k.get("/security/blocked-ips");e.success&&(G.value=e.data||[])}catch(e){}finally{J.value=!1}},ue=async()=>{K.value=!0;try{const e={limit:100};ae.type&&(e.type=ae.type),ae.severity&&(e.severity=ae.severity),ae.ip&&(e.ip=ae.ip);const a=await k.get("/security/attacks",{params:e});a.success&&(W.value=a.data||[],ee.value=W.value.length)}catch(e){}finally{K.value=!1}},ne=async()=>{N.value=!0;try{const e=await k.get("/security/whitelist");e.success&&(le.value=e.data||[])}catch(e){le.value=[]}finally{N.value=!1}},pe=async()=>{if(ie.ip){O.value=!0;try{const e=await k.post("/security/block-ip",{ip:ie.ip,duration:-1===ie.duration?null:ie.duration,reason:ie.reason||"ç®¡ç†å‘˜æ‰‹åŠ¨å°ç¦",permanent:-1===ie.duration});e.success?(g.success(`IP ${ie.ip} å·²è¢«å°ç¦`),te.value=!1,ie.ip="",ie.reason="",await ce(),await re()):g.error(e.message||"å°ç¦å¤±è´¥")}catch(e){g.error("å°ç¦å¤±è´¥")}finally{O.value=!1}}else g.warning("è¯·è¾“å…¥IPåœ°å€")},ve=async()=>{if(de.ip){R.value=!0;try{const e=await k.post("/security/whitelist",{ip:de.ip,description:de.description||""});e.success?(g.success(`IP ${de.ip} å·²åŠ å…¥ç™½åå•`),se.value=!1,de.ip="",de.description="",await ne()):g.error(e.message||"æ·»åŠ å¤±è´¥")}catch(e){g.error("æ·»åŠ å¤±è´¥")}finally{R.value=!1}}else g.warning("è¯·è¾“å…¥IPåœ°å€")},me=e=>e?I(e).format("YYYY-MM-DD HH:mm:ss"):"-",fe=e=>({sql_injection:"SQLæ³¨å…¥",xss:"XSSæ”»å‡»",brute_force:"æš´åŠ›ç ´è§£",rate_limit:"é€Ÿç‡é™åˆ¶",bot_detection:"æœºå™¨äºº",ddos:"DDoS",other:"å…¶ä»–"}[e]||e),_e=e=>({low:"ä½",medium:"ä¸­",high:"é«˜",critical:"ä¸¥é‡"}[e]||e),be=e=>{"blocked"===e?ce():"attacks"===e?ue():"whitelist"===e&&ne()},ye=async()=>{await Promise.all([re(),ce(),ue()])};return l(()=>{ye(),ne(),oe=setInterval(()=>{re(),"blocked"===E.value&&ce()},3e4)}),t(()=>{oe&&clearInterval(oe)}),(e,a)=>{const l=c("el-icon"),t=c("el-button"),I=c("el-card"),P=c("el-table-column"),oe=c("el-tag"),we=c("el-table"),he=c("el-tab-pane"),ge=c("el-option"),ke=c("el-select"),Ie=c("el-form-item"),Pe=c("el-input"),Ve=c("el-form"),xe=c("el-pagination"),Ce=c("el-tabs"),Ue=c("el-dialog"),ze=u("loading");return i(),s("div",V,[d("div",x,[a[18]||(a[18]=d("h1",null,"IPå°ç¦ç®¡ç†",-1)),d("div",C,[o(t,{type:"primary",onClick:ye,loading:J.value},{default:r(()=>[o(l,null,{default:r(()=>[o(p(b))]),_:1}),a[16]||(a[16]=n(" åˆ·æ–° ",-1))]),_:1},8,["loading"]),o(t,{type:"danger",onClick:a[0]||(a[0]=e=>te.value=!0)},{default:r(()=>[o(l,null,{default:r(()=>[o(p(y))]),_:1}),a[17]||(a[17]=n(" å°ç¦IP ",-1))]),_:1})])]),d("div",U,[o(I,{class:"stat-card blocked"},{default:r(()=>[a[20]||(a[20]=d("div",{class:"stat-icon"},"ğŸš«",-1)),d("div",z,[a[19]||(a[19]=d("div",{class:"stat-label"},"å·²å°ç¦IP",-1)),d("div",j,v(F.blockedIPs),1)])]),_:1}),o(I,{class:"stat-card attacks"},{default:r(()=>[a[22]||(a[22]=d("div",{class:"stat-icon"},"âš”ï¸",-1)),d("div",q,[a[21]||(a[21]=d("div",{class:"stat-label"},"ä»Šæ—¥æ”»å‡»",-1)),d("div",$,v(F.todayAttacks),1)])]),_:1}),o(I,{class:"stat-card critical"},{default:r(()=>[a[24]||(a[24]=d("div",{class:"stat-icon"},"ğŸ”¥",-1)),d("div",A,[a[23]||(a[23]=d("div",{class:"stat-label"},"ä¸¥é‡æ”»å‡»",-1)),d("div",S,v(F.criticalAttacks),1)])]),_:1}),o(I,{class:"stat-card tracked"},{default:r(()=>[a[26]||(a[26]=d("div",{class:"stat-icon"},"ğŸ‘ï¸",-1)),d("div",D,[a[25]||(a[25]=d("div",{class:"stat-label"},"ç›‘æ§IPæ•°",-1)),d("div",Y,v(F.trackedIPs),1)])]),_:1})]),o(Ce,{modelValue:E.value,"onUpdate:modelValue":a[6]||(a[6]=e=>E.value=e),onTabChange:be},{default:r(()=>[o(he,{label:"å°ç¦åˆ—è¡¨",name:"blocked"},{default:r(()=>[o(I,{class:"table-card"},{default:r(()=>[m((i(),f(we,{data:G.value,stripe:""},{default:r(()=>[o(P,{prop:"ip",label:"IPåœ°å€",width:"180"},{default:r(({row:e})=>[d("span",M,v(e.ip),1)]),_:1}),o(P,{label:"å°ç¦æ—¶é—´",width:"180"},{default:r(({row:e})=>[n(v(me(e.blockedAt)),1)]),_:1}),o(P,{label:"å‰©ä½™æ—¶é—´",width:"120"},{default:r(({row:e})=>[e.permanent?(i(),f(oe,{key:0,type:"danger",size:"small"},{default:r(()=>[...a[27]||(a[27]=[n("æ°¸ä¹…",-1)])]),_:1})):(i(),s("span",B,v(e.remainingTime)+"s",1))]),_:1}),o(P,{prop:"reason",label:"å°ç¦åŸå› ","min-width":"200"}),o(P,{label:"æ“ä½œ",width:"120",fixed:"right"},{default:r(({row:e})=>[o(t,{type:"success",size:"small",onClick:a=>(async e=>{try{await h.confirm(`ç¡®å®šè¦è§£å°IP ${e} å—ï¼Ÿ`,"ç¡®è®¤è§£å°",{type:"info"});const a=await k.post("/security/unblock-ip",{ip:e});a.success?(g.success(`IP ${e} å·²è§£å°`),await ce(),await re()):g.error(a.message||"è§£å°å¤±è´¥")}catch(a){"cancel"!==a&&g.error("è§£å°å¤±è´¥")}})(e.ip)},{default:r(()=>[...a[28]||(a[28]=[n(" è§£å° ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ze,J.value]])]),_:1})]),_:1}),o(he,{label:"æ”»å‡»æ—¥å¿—",name:"attacks"},{default:r(()=>[o(I,{class:"filter-card"},{default:r(()=>[o(Ve,{inline:!0,model:ae},{default:r(()=>[o(Ie,{label:"æ”»å‡»ç±»å‹"},{default:r(()=>[o(ke,{modelValue:ae.type,"onUpdate:modelValue":a[1]||(a[1]=e=>ae.type=e),placeholder:"å…¨éƒ¨",clearable:"",onChange:ue,style:{width:"150px"}},{default:r(()=>[o(ge,{label:"SQLæ³¨å…¥",value:"sql_injection"}),o(ge,{label:"XSSæ”»å‡»",value:"xss"}),o(ge,{label:"æš´åŠ›ç ´è§£",value:"brute_force"}),o(ge,{label:"é€Ÿç‡é™åˆ¶",value:"rate_limit"}),o(ge,{label:"æœºå™¨äºº",value:"bot_detection"}),o(ge,{label:"å…¶ä»–",value:"other"})]),_:1},8,["modelValue"])]),_:1}),o(Ie,{label:"ä¸¥é‡ç¨‹åº¦"},{default:r(()=>[o(ke,{modelValue:ae.severity,"onUpdate:modelValue":a[2]||(a[2]=e=>ae.severity=e),placeholder:"å…¨éƒ¨",clearable:"",onChange:ue,style:{width:"120px"}},{default:r(()=>[o(ge,{label:"ä½",value:"low"}),o(ge,{label:"ä¸­",value:"medium"}),o(ge,{label:"é«˜",value:"high"}),o(ge,{label:"ä¸¥é‡",value:"critical"})]),_:1},8,["modelValue"])]),_:1}),o(Ie,{label:"IPæœç´¢"},{default:r(()=>[o(Pe,{modelValue:ae.ip,"onUpdate:modelValue":a[3]||(a[3]=e=>ae.ip=e),placeholder:"è¾“å…¥IPåœ°å€",clearable:"",onKeyup:_(ue,["enter"]),style:{width:"180px"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1}),o(I,{class:"table-card"},{default:r(()=>[m((i(),f(we,{data:W.value,stripe:""},{default:r(()=>[o(P,{prop:"id",label:"ID",width:"80"}),o(P,{prop:"ip_address",label:"IPåœ°å€",width:"150"},{default:r(({row:e})=>[d("span",H,v(e.ip_address),1)]),_:1}),o(P,{label:"æ”»å‡»ç±»å‹",width:"120"},{default:r(({row:e})=>{return[o(oe,{type:(a=e.attack_type,{sql_injection:"danger",xss:"danger",brute_force:"warning",rate_limit:"info",bot_detection:"warning",other:""}[a]||""),size:"small"},{default:r(()=>[n(v(fe(e.attack_type)),1)]),_:2},1032,["type"])];var a}),_:1}),o(P,{label:"ä¸¥é‡ç¨‹åº¦",width:"100"},{default:r(({row:e})=>{return[o(oe,{type:(a=e.severity,{low:"info",medium:"warning",high:"danger",critical:"danger"}[a]||""),size:"small"},{default:r(()=>[n(v(_e(e.severity)),1)]),_:2},1032,["type"])];var a}),_:1}),o(P,{prop:"request_path",label:"è¯·æ±‚è·¯å¾„","min-width":"200"},{default:r(({row:e})=>[d("span",L,v(e.request_method)+" "+v(e.request_path),1)]),_:1}),o(P,{label:"å·²å°ç¦",width:"80"},{default:r(({row:e})=>[e.blocked?(i(),f(oe,{key:0,type:"danger",size:"small"},{default:r(()=>[...a[29]||(a[29]=[n("æ˜¯",-1)])]),_:1})):(i(),f(oe,{key:1,type:"info",size:"small"},{default:r(()=>[...a[30]||(a[30]=[n("å¦",-1)])]),_:1}))]),_:1}),o(P,{label:"æ—¶é—´",width:"180"},{default:r(({row:e})=>[n(v(me(e.created_at)),1)]),_:1}),o(P,{label:"æ“ä½œ",width:"120",fixed:"right"},{default:r(({row:e})=>[o(t,{type:"danger",size:"small",onClick:a=>(async e=>{try{await h.confirm(`ç¡®å®šè¦å°ç¦IP ${e} å—ï¼Ÿ`,"ç¡®è®¤å°ç¦",{type:"warning"});const a=await k.post("/security/block-ip",{ip:e,duration:864e5,reason:"ä»æ”»å‡»æ—¥å¿—æ‰‹åŠ¨å°ç¦"});a.success?(g.success(`IP ${e} å·²è¢«å°ç¦`),await ce(),await ue(),await re()):g.error(a.message||"å°ç¦å¤±è´¥")}catch(a){"cancel"!==a&&g.error("å°ç¦å¤±è´¥")}})(e.ip_address)},{default:r(()=>[...a[31]||(a[31]=[n(" å°ç¦ ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ze,K.value]]),d("div",Q,[o(xe,{"current-page":Z.value,"onUpdate:currentPage":a[4]||(a[4]=e=>Z.value=e),"page-size":20,total:ee.value,layout:"total, prev, pager, next",onCurrentChange:ue},null,8,["current-page","total"])])]),_:1})]),_:1}),o(he,{label:"IPç™½åå•",name:"whitelist"},{default:r(()=>[o(I,{class:"table-card"},{default:r(()=>[d("div",T,[o(t,{type:"success",onClick:a[5]||(a[5]=e=>se.value=!0)},{default:r(()=>[o(l,null,{default:r(()=>[o(p(w))]),_:1}),a[32]||(a[32]=n(" æ·»åŠ ç™½åå• ",-1))]),_:1})]),m((i(),f(we,{data:le.value,stripe:""},{default:r(()=>[o(P,{prop:"ip_address",label:"IPåœ°å€",width:"180"},{default:r(({row:e})=>[d("span",X,v(e.ip_address),1)]),_:1}),o(P,{prop:"description",label:"æè¿°","min-width":"200"}),o(P,{prop:"added_by",label:"æ·»åŠ è€…",width:"120"}),o(P,{label:"æ·»åŠ æ—¶é—´",width:"180"},{default:r(({row:e})=>[n(v(me(e.created_at)),1)]),_:1}),o(P,{label:"æ“ä½œ",width:"120",fixed:"right"},{default:r(({row:e})=>[o(t,{type:"danger",size:"small",onClick:a=>(async e=>{try{await h.confirm(`ç¡®å®šè¦å°†IP ${e} ä»ç™½åå•ç§»é™¤å—ï¼Ÿ`,"ç¡®è®¤ç§»é™¤",{type:"warning"});const a=await k.delete(`/security/whitelist/${encodeURIComponent(e)}`);a.success?(g.success(`IP ${e} å·²ä»ç™½åå•ç§»é™¤`),await ne()):g.error(a.message||"ç§»é™¤å¤±è´¥")}catch(a){"cancel"!==a&&g.error("ç§»é™¤å¤±è´¥")}})(e.ip_address)},{default:r(()=>[...a[33]||(a[33]=[n(" ç§»é™¤ ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ze,N.value]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(Ue,{modelValue:te.value,"onUpdate:modelValue":a[11]||(a[11]=e=>te.value=e),title:"å°ç¦IP",width:"500px"},{footer:r(()=>[o(t,{onClick:a[10]||(a[10]=e=>te.value=!1)},{default:r(()=>[...a[34]||(a[34]=[n("å–æ¶ˆ",-1)])]),_:1}),o(t,{type:"danger",onClick:pe,loading:O.value},{default:r(()=>[...a[35]||(a[35]=[n("ç¡®è®¤å°ç¦",-1)])]),_:1},8,["loading"])]),default:r(()=>[o(Ve,{model:ie,"label-width":"100px"},{default:r(()=>[o(Ie,{label:"IPåœ°å€",required:""},{default:r(()=>[o(Pe,{modelValue:ie.ip,"onUpdate:modelValue":a[7]||(a[7]=e=>ie.ip=e),placeholder:"è¾“å…¥è¦å°ç¦çš„IPåœ°å€"},null,8,["modelValue"])]),_:1}),o(Ie,{label:"å°ç¦æ—¶é•¿"},{default:r(()=>[o(ke,{modelValue:ie.duration,"onUpdate:modelValue":a[8]||(a[8]=e=>ie.duration=e),style:{width:"100%"}},{default:r(()=>[o(ge,{label:"5åˆ†é’Ÿ",value:3e5}),o(ge,{label:"15åˆ†é’Ÿ",value:9e5}),o(ge,{label:"1å°æ—¶",value:36e5}),o(ge,{label:"24å°æ—¶",value:864e5}),o(ge,{label:"7å¤©",value:6048e5}),o(ge,{label:"æ°¸ä¹…",value:-1})]),_:1},8,["modelValue"])]),_:1}),o(Ie,{label:"å°ç¦åŸå› "},{default:r(()=>[o(Pe,{modelValue:ie.reason,"onUpdate:modelValue":a[9]||(a[9]=e=>ie.reason=e),type:"textarea",rows:"3",placeholder:"è¾“å…¥å°ç¦åŸå› ï¼ˆå¯é€‰ï¼‰"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),o(Ue,{modelValue:se.value,"onUpdate:modelValue":a[15]||(a[15]=e=>se.value=e),title:"æ·»åŠ ç™½åå•",width:"500px"},{footer:r(()=>[o(t,{onClick:a[14]||(a[14]=e=>se.value=!1)},{default:r(()=>[...a[36]||(a[36]=[n("å–æ¶ˆ",-1)])]),_:1}),o(t,{type:"primary",onClick:ve,loading:R.value},{default:r(()=>[...a[37]||(a[37]=[n(" æ·»åŠ  ",-1)])]),_:1},8,["loading"])]),default:r(()=>[o(Ve,{model:de,"label-width":"100px"},{default:r(()=>[o(Ie,{label:"IPåœ°å€",required:""},{default:r(()=>[o(Pe,{modelValue:de.ip,"onUpdate:modelValue":a[12]||(a[12]=e=>de.ip=e),placeholder:"è¾“å…¥IPåœ°å€"},null,8,["modelValue"])]),_:1}),o(Ie,{label:"æè¿°"},{default:r(()=>[o(Pe,{modelValue:de.description,"onUpdate:modelValue":a[13]||(a[13]=e=>de.description=e),type:"textarea",rows:"2",placeholder:"è¾“å…¥æè¿°ï¼ˆå¯é€‰ï¼‰"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},[["__scopeId","data-v-9dd64140"]]);export{J as default};
