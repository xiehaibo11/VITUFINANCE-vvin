import{r as e,_ as a,x as l,A as t,o as s,D as o,J as r,B as n,M as i,C as u,ay as d,P as c,ac as p,Y as g,aI as m,m as f,u as v,K as h,O as _}from"./vue-vendor-CCmsYA1Y.js";import{m as b,S as y,I as w,T as M,L as k,ad as Y,ae as z,b as C}from"./element-plus-BZcENYie.js";import{bC as x}from"./vendor-BQF3adi-.js";import{r as S}from"./index-DcuAk0vn.js";import{_ as V}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./index-BxKU4Ero.js";const I={class:"page-container"},A={class:"page-header"},D={class:"quick-filters"},R={key:0,class:"filter-count"},H={class:"search-area"},P={class:"log-detail"},j={class:"detail-item"},U={class:"detail-value"},O={key:0,class:"detail-item"},q={class:"detail-value"},T={key:1,class:"detail-item"},J={class:"detail-code"},N={key:2,class:"detail-item"},W={class:"detail-code"},E={class:"log-time"},K={class:"log-user"},L=["onClick"],B={class:"log-message"},F={key:1,class:"log-message"},G={class:"pagination-wrapper"},Q=V({__name:"Logs",setup(V){const Q=e(!1),X=e([{label:"全部",value:"all",count:0},{label:"今日",value:"today",count:0},{label:"错误",value:"error",count:0},{label:"安全",value:"security",count:0},{label:"登录",value:"login",count:0}]),Z=e("all"),$=e([]),ee=a({level:"",action:"",ip:"",dateRange:null}),ae=a({page:1,pageSize:20,total:0}),le=async()=>{Q.value=!0;try{const e={page:ae.page,pageSize:ae.pageSize,level:ee.level||void 0,action:ee.action||void 0,ip:ee.ip||void 0};ee.dateRange&&(e.start_time=ee.dateRange[0],e.end_time=ee.dateRange[1]);const a=await S.get("/logs",{params:e});a.success&&($.value=a.data.list||[],ae.total=a.data.total||0)}catch(e){$.value=te(),ae.total=500}finally{Q.value=!1}},te=()=>{const e=["info","info","info","warning","error","security"],a=["login","logout","deposit","withdraw","balance_change","settings","api"],l=["success","success","success","failed"],t=["用户登录成功","用户登出","处理充值请求","处理提款请求","更新用户余额","修改系统设置","API请求处理","登录失败：密码错误","检测到异常登录尝试","安全警告：多次登录失败"],s=["192.168.1.1","10.0.0.1","172.16.0.1","203.156.78.45","45.32.156.78"],o=["admin","admin","system",null];return Array.from({length:20},(r,n)=>{const i=e[Math.floor(Math.random()*e.length)],u=a[Math.floor(Math.random()*a.length)];return{id:n+1,level:i,action:u,user:o[Math.floor(Math.random()*o.length)],ip:s[Math.floor(Math.random()*s.length)],message:t[Math.floor(Math.random()*t.length)],status:l[Math.floor(Math.random()*l.length)],user_agent:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",request_data:"api"===u?{method:"GET",path:"/api/users"}:null,response_data:"api"===u?{success:!0,count:10}:null,created_at:x().subtract(Math.floor(48*Math.random()),"hour").subtract(Math.floor(60*Math.random()),"minute").toISOString()}})},se=()=>{ae.page=1,le()},oe=()=>{Z.value="all",ee.level="",ee.action="",ee.ip="",ee.dateRange=null,ae.page=1,le()},re=()=>{ae.page=1,le()},ne=()=>{le()},ie=e=>({info:"信息",warning:"警告",error:"错误",security:"安全"}[e]||e),ue=({row:e})=>"error"===e.level?"error-row":"warning"===e.level?"warning-row":"security"===e.level?"security-row":"";return l(()=>{le()}),(e,a)=>{const l=d("el-icon"),S=d("el-tag"),V=d("el-option"),le=d("el-select"),te=d("el-form-item"),de=d("el-input"),ce=d("el-date-picker"),pe=d("el-button"),ge=d("el-form"),me=d("el-table-column"),fe=d("el-tooltip"),ve=d("el-table"),he=d("el-pagination"),_e=m("loading");return s(),t("div",I,[o("div",A,[o("h2",null,[n(l,null,{default:u(()=>[n(v(b))]),_:1}),a[6]||(a[6]=i(" 系统日志 ",-1))]),a[7]||(a[7]=o("p",{class:"description"},"查看系统操作日志和安全事件",-1))]),o("div",D,[(s(!0),t(c,null,p(X.value,e=>(s(),f(S,{key:e.value,type:Z.value===e.value?"primary":"info",effect:Z.value===e.value?"dark":"plain",class:"filter-tag",onClick:a=>(e=>{switch(Z.value=e,ee.level="",ee.action="",ee.ip="",ee.dateRange=null,e){case"today":ee.dateRange=[x().startOf("day").format("YYYY-MM-DD HH:mm:ss"),x().endOf("day").format("YYYY-MM-DD HH:mm:ss")];break;case"error":ee.level="error";break;case"security":ee.level="security";break;case"login":ee.action="login"}se()})(e.value)},{default:u(()=>[i(_(e.label)+" ",1),e.count?(s(),t("span",R,_(e.count),1)):h("",!0)]),_:2},1032,["type","effect","onClick"]))),128))]),o("div",H,[n(ge,{inline:!0,model:ee,onSubmit:g(se,["prevent"])},{default:u(()=>[n(te,{label:"日志级别"},{default:u(()=>[n(le,{modelValue:ee.level,"onUpdate:modelValue":a[0]||(a[0]=e=>ee.level=e),placeholder:"全部",clearable:"",style:{width:"120px"}},{default:u(()=>[n(V,{label:"信息",value:"info"}),n(V,{label:"警告",value:"warning"}),n(V,{label:"错误",value:"error"}),n(V,{label:"安全",value:"security"})]),_:1},8,["modelValue"])]),_:1}),n(te,{label:"操作类型"},{default:u(()=>[n(le,{modelValue:ee.action,"onUpdate:modelValue":a[1]||(a[1]=e=>ee.action=e),placeholder:"全部",clearable:"",style:{width:"140px"}},{default:u(()=>[n(V,{label:"登录",value:"login"}),n(V,{label:"登出",value:"logout"}),n(V,{label:"充值",value:"deposit"}),n(V,{label:"提款",value:"withdraw"}),n(V,{label:"余额变更",value:"balance_change"}),n(V,{label:"系统设置",value:"settings"}),n(V,{label:"API请求",value:"api"})]),_:1},8,["modelValue"])]),_:1}),n(te,{label:"IP地址"},{default:u(()=>[n(de,{modelValue:ee.ip,"onUpdate:modelValue":a[2]||(a[2]=e=>ee.ip=e),placeholder:"请输入IP地址",clearable:"",style:{width:"160px"}},null,8,["modelValue"])]),_:1}),n(te,{label:"时间范围"},{default:u(()=>[n(ce,{modelValue:ee.dateRange,"onUpdate:modelValue":a[3]||(a[3]=e=>ee.dateRange=e),type:"datetimerange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"360px"}},null,8,["modelValue"])]),_:1}),n(te,null,{default:u(()=>[n(pe,{type:"primary",onClick:se},{default:u(()=>[n(l,null,{default:u(()=>[n(v(y))]),_:1}),a[8]||(a[8]=i(" 搜索 ",-1))]),_:1}),n(pe,{onClick:oe},{default:u(()=>[n(l,null,{default:u(()=>[n(v(w))]),_:1}),a[9]||(a[9]=i(" 重置 ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),r((s(),f(ve,{data:$.value,stripe:"",border:"",style:{width:"100%"},"row-class-name":ue},{default:u(()=>[n(me,{type:"expand"},{default:u(({row:e})=>[o("div",P,[o("div",j,[a[10]||(a[10]=o("span",{class:"detail-label"},"完整消息：",-1)),o("span",U,_(e.message),1)]),e.user_agent?(s(),t("div",O,[a[11]||(a[11]=o("span",{class:"detail-label"},"User-Agent：",-1)),o("span",q,_(e.user_agent),1)])):h("",!0),e.request_data?(s(),t("div",T,[a[12]||(a[12]=o("span",{class:"detail-label"},"请求数据：",-1)),o("pre",J,_(JSON.stringify(e.request_data,null,2)),1)])):h("",!0),e.response_data?(s(),t("div",N,[a[13]||(a[13]=o("span",{class:"detail-label"},"响应数据：",-1)),o("pre",W,_(JSON.stringify(e.response_data,null,2)),1)])):h("",!0)])]),_:1}),n(me,{prop:"created_at",label:"时间",width:"170"},{default:u(({row:e})=>{return[o("span",E,_((a=e.created_at,x(a).format("YYYY-MM-DD HH:mm:ss"))),1)];var a}),_:1}),n(me,{prop:"level",label:"级别",width:"90",align:"center"},{default:u(({row:e})=>{return[n(S,{type:(a=e.level,{info:"info",warning:"warning",error:"danger",security:""}[a]||"info"),size:"small",effect:"dark"},{default:u(()=>[i(_(ie(e.level)),1)]),_:2},1032,["type"])];var a}),_:1}),n(me,{prop:"action",label:"操作类型",width:"120"},{default:u(({row:e})=>[n(S,{type:"info",size:"small"},{default:u(()=>{return[i(_((a=e.action,{login:"登录",logout:"登出",deposit:"充值",withdraw:"提款",balance_change:"余额变更",settings:"系统设置",api:"API请求"}[a]||a)),1)];var a}),_:2},1024)]),_:1}),n(me,{prop:"user",label:"操作者",width:"120"},{default:u(({row:e})=>[o("span",K,_(e.user||"-"),1)]),_:1}),n(me,{prop:"ip",label:"IP地址",width:"140"},{default:u(({row:e})=>[o("span",{class:"log-ip",onClick:a=>{return l=e.ip,navigator.clipboard.writeText(l),void C.success("已复制");var l}},[i(_(e.ip)+" ",1),n(l,null,{default:u(()=>[n(v(M))]),_:1})],8,L)]),_:1}),n(me,{prop:"message",label:"日志内容","min-width":"300"},{default:u(({row:e})=>[e.message&&e.message.length>60?(s(),f(fe,{key:0,content:e.message,placement:"top"},{default:u(()=>[o("span",B,_(e.message.slice(0,60))+"...",1)]),_:2},1032,["content"])):(s(),t("span",F,_(e.message),1))]),_:1}),n(me,{prop:"status",label:"状态",width:"90",align:"center"},{default:u(({row:e})=>["success"===e.status?(s(),f(l,{key:0,color:"#67C23A"},{default:u(()=>[n(v(k))]),_:1})):"failed"===e.status?(s(),f(l,{key:1,color:"#F56C6C"},{default:u(()=>[n(v(Y))]),_:1})):(s(),f(l,{key:2,color:"#E6A23C"},{default:u(()=>[n(v(z))]),_:1}))]),_:1})]),_:1},8,["data"])),[[_e,Q.value]]),o("div",G,[n(he,{"current-page":ae.page,"onUpdate:currentPage":a[4]||(a[4]=e=>ae.page=e),"page-size":ae.pageSize,"onUpdate:pageSize":a[5]||(a[5]=e=>ae.pageSize=e),"page-sizes":[20,50,100,200],total:ae.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:re,onCurrentChange:ne},null,8,["current-page","page-size","total"])])])}}},[["__scopeId","data-v-0b29d164"]]);export{Q as default};
