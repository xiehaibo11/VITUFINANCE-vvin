"use strict";var TaskError=require("./errors/taskerror");var yargs=require("yargs/yargs");var _=require("lodash");var version=require("./version");function Command(commands){var _this=this;this.commands=commands;var args=yargs().detectLocale(false).exitProcess(false);Object.keys(this.commands).forEach(function(command){args.command(_this.commands[command])});this.args=args}Command.prototype.getCommand=function(cmds,noAliases){var _this2=this;var args=yargs().detectLocale(false).exitProcess(false).version(false).help(false);Object.keys(this.commands).forEach(function(command){args.command(_this2.commands[command])});var argv=args.parse(cmds);if(argv._.length===0){argv._.push("help")}var input=argv._[0];var chosenCommand=null;if(this.commands[input]){chosenCommand=input}else if(noAliases!==true){var currentLength=1;var availableCommandNames=Object.keys(this.commands);while(currentLength<=input.length){var possibleCommands=availableCommandNames.filter(function(possibleCommand){return possibleCommand.substring(0,currentLength)===input.substring(0,currentLength)});if(possibleCommands.length===1){chosenCommand=possibleCommands[0];break}currentLength+=1}}if(!chosenCommand){return null}var command=this.commands[chosenCommand];return{name:chosenCommand,argv:argv,command:command}};Command.prototype.run=function(command,options,callback){if(typeof options==="function"){callback=options;options={}}var result=this.getCommand(command,typeof options.noAliases==="boolean"?options.noAliases:true);if(!result){return callback(new TaskError("`tronbox ".concat(command[0],"` is an invalid command.\n\nPlease use `tronbox help` to see a list of available commands.\n\nTronBox v").concat(version.bundle)))}var argv=result.argv;if(argv._){argv._.shift()}delete argv["$0"];var clone={};Object.keys(options).forEach(function(key){try{clone[key]=options[key]}catch(e){}});options=_.extend(clone,argv);options.commands=this.commands;if(result.name!=="help"&&argv.help){this.args.parse(command);return callback()}try{result.command.run(options,callback)}catch(err){callback(err)}};module.exports=Command;